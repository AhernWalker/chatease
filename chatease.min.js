chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="1.0.07";
(function(d){var e=d.utils={};e.exists=function(a){switch(e.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};e.extend=function(){var a=Array.prototype.slice.call(arguments,0),c=a[0];if(1<a.length)for(var b=1;b<a.length;b++)e.foreach(a[b],function(b,a){void 0!==a&&null!==a&&(c[b]=a)});return c};e.foreach=function(a,c){for(var b in a)a.hasOwnProperty&&"function"===e.typeOf(a.hasOwnProperty)?a.hasOwnProperty(b)&&c(b,a[b]):c(b,a[b])};e.getCookie=
function(a){var c;return(c=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(c[2]):null};e.formatTime=function(a){var c=a.getHours()+1,b=a.getMinutes(),d=a.getSeconds();return a.toLocaleDateString()+" "+e.pad(c,2)+":"+e.pad(b,2)+":"+e.pad(d,2)};e.pad=function(a,c){for(a+="";a.length<c;)a="0"+a;return a};e.createElement=function(a,c){a=document.createElement(a);c&&(a.className=c);return a};e.addClass=function(a,c){var b="string"===e.typeOf(a.className)?a.className.split(" "):[];
c="array"===e.typeOf(c)?c:c.split(" ");e.foreach(c,function(c,a){-1===e.indexOf(b,a)&&b.push(a)});a.className=e.trim(b.join(" "))};e.removeClass=function(a,c){var b="string"===e.typeOf(a.className)?a.className.split(" "):[];c="array"===e.typeOf(c)?c:c.split(" ");e.foreach(c,function(a,c){a=e.indexOf(b,c);0<=a&&b.splice(a,1)});a.className=e.trim(b.join(" "))};e.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};e.typeOf=function(a){if(null===a||void 0===a)return"null";var c=typeof a;
if("object"===c)try{if("[object Array]"===toString.call(a))return"array"}catch(b){}return c};e.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};e.indexOf=function(a,c){if(null==a)return-1;for(var b=0;b<a.length;b++)if(a[b]===c)return b;return-1};e.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),a=new RegExp("msie\\s*"+a,"i"),null!==navigator.userAgent.toLowerCase().match(a)):null!==navigator.userAgent.toLowerCase().match(/msie/i)};var f=window.console=window.console||{log:function(){}};
e.log=function(){var a=Array.prototype.slice.call(arguments,0);"object"===e.typeOf(f.log)?f.log(a):f.log.apply(f,a)}})(chatease);
(function(d){function e(){var a=document.createElement("style");a.type="text/css";document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet}var f=d.utils,a;(f.css=function(c,b){a||(a=e());var d="";f.foreach(b,function(a,b){d+=a+": "+b+"; "});try{a.insertRule?a.insertRule(c+" { "+d+"}",a.cssRules.length):a.addRule(c,d,a.rules.length)}catch(g){f.log("Failed to insert css rule: "+c)}}).style=function(a,b,e){if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),b=f.extend({},
b),e=0;e<a.length;e++){var c=a[e];void 0!==c&&null!==c&&f.foreach(b,function(a,b){a=a.split("-");for(var e=1;e<a.length;e++)a[e]=a[e].charAt(0).toUpperCase()+a[e].slice(1);a=a.join("");c.style[a]!==b&&(c.style[a]=b)})}}})(chatease);(function(d){var e=d.utils;e.filter=function(d){var a,c="";this.replace=function(b){return c&&a?b.replace(a,"**"):b};"string"==e.typeOf(d)&&d&&(c=d,a=new RegExp(c,"ig"))}})(chatease);
(function(d){d.events={ERROR:"error",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_PROPERTY:"chateaseProperty",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_USERS:"chateaseUsers",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_PROPERTY:"chateaseViewProperty",
CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(d){var e=d.utils;d.events.eventdispatcher=function(f){function a(a,b,c){if(a)for(var d=0;d<a.length;d++){var h=a[d];if(h){null!==h.count&&0===--h.count&&delete a[d];try{h.listener(b)}catch(q){e.log('Error handling "'+c+'" event listener ['+d+"]: "+q.toString(),h.listener,b)}}}}var c={},b=[];this.addEventListener=function(a,b,d){try{e.exists(c[a])||(c[a]=[]),"string"===e.typeOf(b)&&(b=(new Function("return "+b))()),c[a].push({listener:b,count:d||null})}catch(v){e.log("error",v)}return!1};
this.removeEventListener=function(a,b){if(c[a]){try{if(void 0===b){c[a]=[];return}var d;for(d=0;d<c[a].length;d++)if(c[a][d].listener.toString()===b.toString()){c[a].splice(d,1);break}}catch(v){e.log("error",v)}return!1}};this.addGlobalListener=function(a,c){try{"string"===e.typeOf(a)&&(a=(new Function("return "+a))()),b.push({listener:a,count:c||null})}catch(k){e.log("error",k)}return!1};this.removeGlobalListener=function(a){if(a){try{var c;for(c=b.length-1;0<=c;c--)b[c].listener.toString()===a.toString()&&
b.splice(c,1)}catch(k){e.log("error",k)}return!1}};this.dispatchEvent=function(m,g){g||(g={});e.extend(g,{id:f,version:d.version,type:m});d.debug&&e.log(m,g);a(c[m],g,m);a(b,g,m)}}})(chatease);
(function(d){var e=d.utils,f=d.events,a={},c={onError:f.ERROR,onReady:f.CHATEASE_READY,onConnect:f.CHATEASE_CONNECT,onIdent:f.CHATEASE_INDENT,onMessage:f.CHATEASE_MESSAGE,onJoin:f.CHATEASE_JOIN,onLeft:f.CHATEASE_LEFT,onUsers:f.CHATEASE_USERS,onNickClick:f.CHATEASE_VIEW_NICKCLICK,onClose:f.CHATEASE_CLOSE};d.api=function(a){function b(a){g.dispatchEvent(a.type,a)}var g=e.extend(this,new f.eventdispatcher("api")),k;g.container=a;g.id=a.id;g.setup=function(a){e.emptyElement(g.container);d.debug=!!a.debug;
g.config=a;g.config.id=g.id;g.embedder=new d.embed(g);g.embedder.addGlobalListener(b);g.embedder.embed();return g};g.setEntity=function(a,b){k=a;g.onSWFLoaded=k.setup;g.onSWFOpen=k.onSWFOpen;g.onSWFMessage=k.onSWFMessage;g.onSWFError=k.onSWFError;g.onSWFClose=k.onSWFClose;g.send=k.send;g.resize=k.resize};(function(){e.foreach(c,function(a,b){g[a]=function(a){g.addEventListener(b,a)}})})()};d.api.getInstance=function(b){var c;null==b?b=0:b.nodeType?c=b:"string"===e.typeOf(b)&&(c=document.getElementById(b));
if(c){var f=a[c.id];f||(a[b]=f=new d.api(c));return f}return"number"===e.typeOf(b)?a[b]:null};d.api.displayError=function(a,c){}})(chatease);(function(d){d.core={}})(chatease);(function(d){d.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);
(function(d){d.core.protocol={};d=d.core.protocol;d.cmds={TEXT:"text",MUTE:"mute",KICKOUT:"kickout",PING:"ping"};d.raws={IDENT:"ident",TEXT:"text",JOIN:"join",LEFT:"left",USERS:"users",MUTE:"mute",KICKOUT:"kickout",ERROR:"error",PONG:"pong"};d.roles={VISITOR:0,NORMAL:1,VIP:14,ASSISTANT:16,SECRETARY:32,ANCHOR:48,ADMIN:64,SU_ADMIN:128,SYSTEM:192};d.channelStates={NORMAL:0,MUTED:1,LOCKED:3};d.punishments={MUTED:1,KICKED_OUT:3};d.errors={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDED:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,
REQUEST_TIMEOUT:408,CONFLICT:409,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504}})(chatease);(function(d){d.core.skins={}})(chatease);(function(d){d.core.skins.modes={DEFAULT:"def"}})(chatease);
(function(d){var e=d.utils,f=d.events;d=d.core.skins;var a=d.modes,c=e.css,b="cha-skin";d.def=function(d){d=e.extend(this,new f.eventdispatcher("skins.def"));d.resize=function(a,b){};d.name=a.DEFAULT;b+="-"+d.name;c(".cha-wrapper",{width:"100%",height:"100%"});c(".cha-wrapper *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});c("."+b+" .cha-button",{padding:".6rem 1.4rem","font-style":"normal",
"font-weight":"normal","text-align":"center","text-transform":"uppercase","white-space":"nowrap","word-spacing":"normal",border:"none","border-radius":".1875rem",cursor:"pointer",display:"inline-block","-webkit-font-smoothing":"subpixel-antialiased","-moz-osx-font-smoothing":"grayscale",transition:"150ms ease-in-out","transition-property":"background-color, color"});c("."+b+" .cha-button.red",{color:"#FFFFFF","background-color":"#FF0046"});c("."+b+" .cha-button.red:hover",{"background-color":"#97052D"});
c("."+b+" .cha-render",{width:"100%",height:"100%",display:"flex","flex-flow":"column nowrap"});c("."+b+" .cha-render .cha-title",{width:"100%",flex:"0 0 40px","font-family":"inherit","font-weight":"normal","text-align":"center","line-height":"40px",color:"#E6E6E6","background-color":"#171717",cursor:"not-allowed","pointer-events":"none"});c("."+b+" .cha-render .cha-console",{flex:"0 0 calc(100% - 140px)",color:"#242424","background-color":"#F8F8F8","overflow-y":"scroll"});c("."+b+" .cha-render .cha-console > div",
{margin:"6px","word-break":"break-all","word-wrap":"break-word"});c("."+b+" .cha-render .cha-console > div.cha-system > a",{"font-style":"normal","font-weight":"bold",color:"#FF0046"});c("."+b+" .cha-render .cha-console > div.cha-myself",{});c("."+b+" .cha-render .cha-console > div.cha-myself > a",{});c("."+b+" .cha-render .cha-console > div > span.ico-visitor",{"margin-right":"6px"});c("."+b+" .cha-render .cha-console > div > span.ico-normal",{"margin-right":"6px"});c("."+b+" .cha-render .cha-console > div > span.ico-vip1",
{});c("."+b+" .cha-render .cha-console > div > span.ico-vip2",{});c("."+b+" .cha-render .cha-console > div > span.ico-vip3",{});c("."+b+" .cha-render .cha-console > div > span.ico-vip4",{});c("."+b+" .cha-render .cha-console > div > span.ico-vip5",{});c("."+b+" .cha-render .cha-console > div > span.ico-vip6",{});c("."+b+" .cha-render .cha-console > div > span.ico-vip7",{});c("."+b+" .cha-render .cha-console > div > span.ico-assistant",{});c("."+b+" .cha-render .cha-console > div > span.ico-secretary",
{});c("."+b+" .cha-render .cha-console > div > span.ico-anchor",{});c("."+b+" .cha-render .cha-console > div > span.ico-admin",{});c("."+b+" .cha-render .cha-console > div > span.ico-suadmin",{});c("."+b+" .cha-render .cha-console > div > span.ico-system",{});c("."+b+" .cha-render .cha-console > div > a",{"margin-right":"6px",color:"#0B7EF4","text-decoration":"none",cursor:"pointer"});c("."+b+" .cha-render .cha-controls",{width:"100%",flex:"0 0 40px","line-height":"100%",display:"flex","flex-flow":"row nowrap",
"justify-content":"space-between","align-items":"stretch","background-color":"#171717",overflow:"hidden"});c("."+b+" .cha-render .cha-controls > *",{margin:"6px 0","text-align":"center",display:"block"});c("."+b+" .cha-render .cha-controls > .cha-checkbox",{color:"#E6E6E6",cursor:"pointer",overflow:"hidden"});c("."+b+" .cha-render .cha-controls > .cha-checkbox > label",{height:"100%",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",cursor:"pointer"});
c("."+b+" .cha-render .cha-controls > .cha-checkbox input[type=checkbox]",{"margin-right":"6px",cursor:"pointer"});c("."+b+" .cha-render .cha-controls > .cha-checkbox a",{});c("."+b+" .cha-render .cha-controls > .cha-button",{});c("."+b+" .cha-render .cha-controls .shieldtext",{"float":"left"});c("."+b+" .cha-render .cha-controls .clearscreen",{"float":"right",width:"3rem"});c("."+b+" .cha-render .cha-dialog",{width:"100%",flex:"0 0 60px",overflow:"hidden"});c("."+b+" .cha-render .cha-dialog .cha-input",
{width:"100%",height:"100%",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"stretch",overflow:"hidden"});c("."+b+" .cha-render .cha-dialog .cha-input textarea",{"margin-right":"6px",padding:"6px 10px",flex:"1 1 calc(100% - 3rem)",resize:"none",border:"0 none","background-color":"#E6E6E6"});c("."+b+" .cha-render .cha-dialog .cha-input button",{flex:"0 0 3rem"})}})(chatease);(function(d){d.core.renders={}})(chatease);(function(d){d.core.renders.modes={DEFAULT:"def"}})(chatease);
(function(d){var e=d.utils,f=d.events;d=d.core;var a=d.protocol.roles;d=d.renders;var c=d.modes;d.def=function(b,d){function g(a,b,c,d,f){b=e.createElement("div",b);var x=e.createElement("label");b.appendChild(x);var y=e.createElement("input");x.appendChild(y);y.type="checkbox";y.checked=!!f;c=function(a,b){return function(c){h.dispatchEvent(a,e.extend({value:y.checked},b))}}(c,d);try{y.addEventListener("change",c)}catch(E){y.attachEvent("onchange",c)}c=e.createElement("a");x.appendChild(c);c.innerHTML=
a;return b}function m(a,b,c,d){b=e.createElement("div",b);var f=e.createElement("a");b.appendChild(f);f.innerHTML=a;a=function(a,b){return function(c){h.dispatchEvent(a,b)}}(c,d);try{f.addEventListener("click",a)}catch(x){f.attachEvent("onclick",a)}return b}function v(b){var c="";return"number"!=e.typeOf(b)&&(b=parseInt(b),NaN==b||0>b)?"":c=b&a.SYSTEM?(b&a.SYSTEM)==a.SYSTEM?c+"ico-system":b&a.SU_ADMIN?c+"ico-suadmin":c+"ico-admin":b&a.ANCHOR?(b&a.ANCHOR)==a.ANCHOR?c+"ico-anchor":b&a.SECRETARY?c+"ico-secretary":
c+"ico-assistant":b&a.VIP?c+("ico-vip"+((b&a.VIP)-1)):(b&a.NORMAL)==a.NORMAL?c+"ico-normal":c+"ico-visitor"}var h=e.extend(this,new f.eventdispatcher("renders.def")),q,p,w,z,l,r,u;h.setup=function(){e.isMSIE(8)||e.isMSIE(9)?setTimeout(function(){_object.setup&&(_object.setup(h.config),h.dispatchEvent(f.CHATEASE_READY,{id:h.config.id}))},0):h.dispatchEvent(f.CHATEASE_READY,{id:h.config.id})};h.show=function(b,c,d){"object"!=e.typeOf(c)&&(c={id:0,name:"[\u7cfb\u7edf]",role:a.SYSTEM});"uni"!=d&&(d="multi");
var g=e.createElement("div");c.role&a.SYSTEM&&(g.className="cha-system");"uni"==d&&(d=e.createElement("span"),d.innerHTML="[\u5bc6\u8bed]",g.appendChild(d));if(d=v(c.role))d=e.createElement("span",d),g.appendChild(d);d=e.createElement("a");d.innerHTML=c.name;c=function(a){return function(b){h.dispatchEvent(f.CHATEASE_VIEW_NICKCLICK,{user:a})}}(c);try{d.addEventListener("click",c)}catch(B){d.attachEvent("onclick",c)}g.appendChild(d);g.insertAdjacentHTML("beforeend",b);p.childNodes.length>=h.config.maxrecords&&
p.removeChild(p.childNodes[0]);p.appendChild(g);p.scrollTop=p.scrollHeight};h.send=function(){h.dispatchEvent(f.CHATEASE_VIEW_SEND,{data:{data:r.value,type:"multi"}});h.clearInput()};h.clearInput=function(){r.value=""};h.clearScreen=function(){e.emptyElement(p)};h.element=function(){return _object};h.resize=function(a,b){};h.destroy=function(){};h.name=c.DEFAULT;h.config=e.extend({},{},d);if(e.isMSIE(8)||e.isMSIE(9))b.innerHTML='<object id="cha-swf" name="cha-swf" align="middle" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"><param name="movie" value="'+
h.config.swf+'"><param name="quality" value="high"><param name="bgcolor" value="#ffffff"><param name="allowscriptaccess" value="sameDomain"><param name="allowfullscreen" value="true"><param name="wmode" value="transparent"><param name="FlashVars" value="id='+h.config.id+'"></object>',_object=h.WebSocket=b.firstChild,_object.style.display="none";(function(){q=e.createElement("div","cha-title");b.appendChild(q);q.innerHTML="\u804a\u5929\u5ba4";p=e.createElement("div","cha-console");b.appendChild(p);
w=e.createElement("div","cha-controls");b.appendChild(w);var a=g("\u5c4f\u853d\u6d88\u606f","cha-checkbox shieldtext",f.CHATEASE_VIEW_PROPERTY,{key:"shield"},!1);w.appendChild(a);a=m("\u6e05\u5c4f","cha-button red clearscreen",f.CHATEASE_VIEW_CLEARSCREEN,null);w.appendChild(a);z=e.createElement("div","cha-dialog");b.appendChild(z);l=e.createElement("div","cha-input");z.appendChild(l);r=e.createElement("textarea");l.appendChild(r);u=e.createElement("button","cha-button red");l.appendChild(u);r.setAttribute("placeholder",
"\u8f93\u5165\u804a\u5929\u5185\u5bb9");h.config.maxlength&&r.setAttribute("maxlength",h.config.maxlength);a=function(){return function(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?r.value+="\r\n":(h.send(),window.event?a.returnValue=!1:a.preventDefault()))}}();try{r.addEventListener("keypress",a)}catch(A){r.attachEvent("onkeypress",a)}u.innerHTML="\u53d1\u9001";a=function(){return function(){h.send()}}();try{u.addEventListener("click",a)}catch(A){u.attachEvent("onclick",a)}})()}})(chatease);
(function(d){var e=d.utils,f=d.events,a=d.core;a.entity=function(c){var b=e.extend(this,new f.eventdispatcher("core.entity")),d,g,k;b.setup=function(){setTimeout(function(){g.setup()},0)};b.destroy=function(){k&&k.stop();g&&g.destroy();d&&d.destroy()};b.id=c.id;b.model=d=new a.model(c);b.view=g=new a.view(d);b.controller=k=new a.controller(d,g);k.addGlobalListener(function(a){b.dispatchEvent(a.type,a)});b.onSWFOpen=k.onOpen;b.onSWFMessage=k.onMessage;b.onSWFError=k.onError;b.onSWFClose=k.onClose;
b.send=k.send;b.getState=d.getState;b.resize=g.resize}})(chatease);
(function(d){var e=d.utils,f=d.events;d=d.core;var a=d.states,c=d.protocol,b=c.roles,m=c.channelStates,g=c.punishments,k=function(){var a=this;_interval=-1;_active=0;a.set=function(c){e.extend(a,c);1==c.hasOwnProperty("role")&&(c=c.role,_interval=0>c?-1:c>=b.ASSISTANT?0:c&b.VIP?500:c==b.NORMAL?1E3:2E3)};a.isMuted=function(){return!!(a.state&m.MUTED|a.punishment.code&g.MUTED)};a.isActive=function(){if(0>_interval)return!1;var a=(new Date).getTime();if(_active&&a-_active<_interval)return!1;_active=
a;return!0};e.extend(a,{channel:null,role:-1,state:0,punishment:{code:0,time:0}})};d.model=function(c){var b=e.extend(this,new f.eventdispatcher("core.model")),d=a.CLOSED,g;b.setState=function(a){a!==d&&(d=a,b.dispatchEvent(f.CHATEASE_STATE,{state:a}))};b.getState=function(){return d};b.setProperty=function(a,c){1==g.hasOwnProperty(a)&&(g[a]=c,b.dispatchEvent(f.CHATEASE_PROPERTY,{key:a,value:c}))};b.getProperty=function(a){return g[a]};b.getConfig=function(a){return b.config[a]};b.destroy=function(){};
b.config=e.extend({},{},c);g={userinfo:new k,shield:!1}}})(chatease);
(function(d){var e=d.utils,f=d.events;d=d.core;var a=d.protocol.roles,c=d.renders,b=d.skins;d.view=function(d){function g(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:l.send()}if(/13|32/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function k(a){}function m(a){h(a)}function h(a){q.dispatchEvent(a.type,a)}var q=e.extend(this,new f.eventdispatcher("core.view")),p,w,z,l,r;q.setup=function(){l?l.setup():q.dispatchEvent(f.CHATEASE_SETUP_ERROR,{message:"Render not available!",
name:d.config.render.name})};q.show=function(b,c,e){(!c||c.role&a.SYSTEM||!d.getProperty("shield"))&&l&&l.show(b,c,e)};q.resize=function(a,b){l&&l.resize(a,b);r&&r.resize(a,b)};q.destroy=function(){p&&p.removeEventListener("keydown",g);l&&l.destroy()};(function(){p=e.createElement("div","cha-wrapper cha-skin-"+d.getConfig("skin").name);p.id=d.getConfig("id");p.tabIndex=0;w=e.createElement("div","cha-render");z=e.createElement("div","cha-contextmenu");p.appendChild(w);p.appendChild(z);var a=e.extend({},
d.getConfig("render"),{id:d.getConfig("id"),url:d.getConfig("url"),width:d.getConfig("width"),height:d.getConfig("height"),maxlength:d.getConfig("maxlength"),maxrecords:d.getConfig("maxrecords")});try{l=q.render=new c[a.name](w,a),l.addEventListener(f.CHATEASE_READY,h),l.addEventListener(f.CHATEASE_VIEW_SEND,h),l.addEventListener(f.CHATEASE_VIEW_PROPERTY,h),l.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,h),l.addEventListener(f.CHATEASE_VIEW_NICKCLICK,h),l.addEventListener(f.CHATEASE_RENDER_ERROR,
m)}catch(n){e.log("Failed to init render "+a.name+"!")}a=e.extend({},d.getConfig("skin"),{id:d.getConfig("id"),width:d.config.width,height:d.config.height});try{r=new b[a.name](a)}catch(n){e.log("Failed to init skin "+a.name+"!")}a=document.getElementById(d.getConfig("id"));a.parentNode.replaceChild(p,a);try{p.addEventListener("keydown",g),window.addEventListener("resize",k)}catch(n){p.attachEvent("onkeydown",g),window.attachEvent("onresize",k)}})()}})(chatease);
(function(d){var e=d.utils,f=d.events;d=d.core;var a=d.states,c=d.protocol,b=c.cmds,m=c.raws,g=c.roles,k=c.channelStates,v=c.punishments,h=c.errors;d.controller=function(c,d){function p(){if(t&&c.getState()==a.CONNECTED)e.log("Websocket had connected already.");else{d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket?(t=new WebSocket(c.config.url),t.onopen=n.onOpen,t.onmessage=n.onMessage,t.onerror=n.onError,t.onclose=n.onClose):
(t=d.render.WebSocket,t.connect())}catch(x){e.log("Failed to initialize websocket: "+x)}}}function q(a){var c="";if("number"!=e.typeOf(a)&&(a=parseInt(a),NaN==a||0>a))return"";a&g.SYSTEM?c=(a&g.SYSTEM)==g.SYSTEM?c+"[\u7cfb\u7edf]":a&g.SU_ADMIN?c+"[\u8d85\u7ba1]":c+"[\u7ba1\u7406\u5458]":a&g.ANCHOR?c=(a&g.ANCHOR)==g.ANCHOR?c+"[\u4e3b\u64ad]":a&g.SECRETARY?c+"[\u52a9\u7406]":c+"[\u623f\u7ba1]":a&g.VIP?c+="[VIP"+((a&g.VIP)-1)+"]":(a&g.NORMAL)!=g.NORMAL&&(c+="[\u6e38\u5ba2]");return c}function l(a,c){var b=
r(a);b&&d.show(b);var g={raw:"error",error:{code:a,explain:b}};e.foreach(c,function(a,c){"cmd"!=a&&"raw"!=a&&"error"!=a&&(g[a]=c)});n.dispatchEvent(f.ERROR,g)}function r(a){var c="";switch(a){case h.BAD_REQUEST:c="\u9519\u8bef\u8bf7\u6c42\uff01";break;case h.UNAUTHORIZED:c="\u8bf7\u5148\u767b\u5f55\uff01";break;case h.FORBIDDED:c="\u6743\u9650\u9519\u8bef\uff01";break;case h.NOT_FOUND:c="\u672a\u77e5\u8bf7\u6c42\uff01";break;case h.CONFLICT:c="\u64cd\u4f5c\u9891\u7e41\uff01";break;case h.INTERNAL_SERVER_ERROR:c=
"\u5185\u90e8\u9519\u8bef\uff01";break;case h.NOT_IMPLEMENTED:c="\u65e0\u6cd5\u8bc6\u522b\uff01";break;case h.BAD_GATEWAY:c="\u54cd\u5e94\u65e0\u6548\uff01";break;case h.SERVICE_UNAVAILABLE:c="\u670d\u52a1\u8fc7\u8f7d\uff01";break;case h.GATEWAY_TIMEOUT:c="\u7f51\u5173\u8d85\u65f6\uff01"}return c}function u(a){n.dispatchEvent(a.type,a)}var n=e.extend(this,new f.eventdispatcher("core.controller")),A=!1,t,C,B=0;n.send=function(b){if(t&&c.getState()==a.CONNECTED)if("object"!=e.typeOf(b)||0==b.hasOwnProperty("cmd"))l(h.BAD_REQUEST,
b);else{var d=c.getProperty("userinfo");0==d.isActive()?l(h.CONFLICT,b):1==d.isMuted()?l(h.FORBIDDED,b):t.send(JSON.stringify(b))}else p()};n.onOpen=function(b){c.setState(a.CONNECTED)};n.onMessage=function(a){var b;try{b=eval("("+a.data+")")}catch(D){e.log("Failed to parse JSON. \nError: "+D+"\ndata: "+a.data);return}switch(b.raw){case m.IDENT:a=c.getProperty("userinfo");a.set(e.extend({},b.user,{channel:b.channel.id,state:b.channel.state}));d.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+a.channel+
"\uff09\u3002");a.state&k.MUTED&&d.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");if(a.punishment.code&v.MUTED){var g=new Date;g.setTime(a.punishment.time);d.show("\u60a8\u5df2\u88ab\u7981\u8a00\u81f3\uff08"+e.formatTime(g)+"\uff09\uff01")}n.dispatchEvent(f.CHATEASE_INDENT,b);break;case m.TEXT:try{C||(C=new e.filter(c.keywords)),b.data=C.replace(b.data)}catch(D){e.log("Failed to execute filter.")}d.show(b.data,b.user,b.type);n.dispatchEvent(f.CHATEASE_MESSAGE,b);
break;case m.JOIN:a=q(b.user.role);d.show((a?a+" ":"")+b.user.name+" \u8fdb\u5165\u623f\u95f4\u3002");n.dispatchEvent(f.CHATEASE_JOIN,b);break;case m.LEFT:a=q(b.user.role);d.show((a?a+" ":"")+b.user.name+" \u5df2\u79bb\u5f00\u3002");n.dispatchEvent(f.CHATEASE_LEFT,b);break;case m.USERS:n.dispatchEvent(f.CHATEASE_USERS,b);break;case m.ERROR:l(b.error.code,b);break;default:e.log("Unknown data type: "+b.raw+", ignored.")}};n.onError=function(b){c.setState(a.ERROR)};n.onClose=function(b){c.setState(a.CLOSED)};
n.close=function(){t&&t.close()};c.addEventListener(f.CHATEASE_STATE,function(b){switch(b.state){case a.CONNECTED:d.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");B=0;n.dispatchEvent(f.CHATEASE_CONNECT);break;case a.CLOSED:d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");n.dispatchEvent(f.CHATEASE_CLOSE,{channel:{id:c.channel}});if(0>c.config.maxretries||B<c.config.maxretries)b=Math.ceil(c.config.retrydelay+5E3*Math.random()),d.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+
b/1E3+"\u79d2..."),B++,t=null,setTimeout(p,b);break;case a.ERROR:d.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");n.dispatchEvent(f.ERROR,{message:"Chat room error!",channel:{id:c.channel}});break;default:n.dispatchEvent(f.ERROR,{message:"Unknown model state!",state:b.state})}});c.addEventListener(f.CHATEASE_PROPERTY,function(a){u(a)});d.addEventListener(f.CHATEASE_READY,function(b){A||(e.log("Chat ready!"),A=!0,u(b),p(),window.onbeforeunload=function(b){t&&c.getState()==a.CONNECTED&&t.close()})});
d.addEventListener(f.CHATEASE_SETUP_ERROR,function(b){c.setState(a.ERROR);u(b)});d.addEventListener(f.CHATEASE_VIEW_SEND,function(a){var f=a.data.data;if(f){0<=c.config.maxlength&&(f=f.substr(0,c.config.maxlength));var f=e.trim(f),g=c.getProperty("userinfo");n.send({cmd:b.TEXT,data:f,type:a.data.type,channel:{id:g.channel}})}else d.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});d.addEventListener(f.CHATEASE_VIEW_PROPERTY,function(a){c.setProperty(a.key,a.value)});d.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,
function(a){d.render.clearScreen();u(a)});d.addEventListener(f.CHATEASE_VIEW_NICKCLICK,function(a){var b=c.getProperty("userinfo");a.channel={id:b.channel,state:b.state};u(a)});d.addEventListener(f.CHATEASE_RENDER_ERROR,function(b){c.setState(a.ERROR);u(b)})}})(chatease);
(function(d){var e=d.utils,f=d.events,a=d.embed=function(c){function b(a){switch(a.type){case f.ERROR:case f.CHATEASE_SETUP_ERROR:case f.CHATEASE_RENDER_ERROR:m.errorScreen(a.message);m.dispatchEvent(f.ERROR,a);break;default:m.dispatchEvent(a.type,a)}}var m=e.extend(this,new f.eventdispatcher("embed")),g={},k=null,v=!1;m.embed=function(){try{g=new a.config(c.config),k=new a.embedder(c,g)}catch(h){e.log("Failed to init embedder!");m.dispatchEvent(f.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",
render:g.render.name});return}k.addGlobalListener(b);k.embed()};m.errorScreen=function(a){v||(v=!0,d.api.displayError(a,g))};(function(){e.foreach(c.config.events,function(a,b){a=c[a];"function"===e.typeOf(a)&&a.call(c,b)})})()}})(chatease);
(function(d){var e=d.utils,f=d.embed,a=d.core.renders.modes,c=d.core.skins.modes;f.config=function(b){return e.extend({},{url:"ws://"+window.location.host+"/ch1?token=123456",width:300,height:450,keywords:"",maxlength:30,maxrecords:50,maxretries:-1,retrydelay:3E3,render:{name:a.DEFAULT,swf:"swf/chatease.swf"},skin:{name:c.DEFAULT}},b)};f.config.addConfig=function(a,c){return e.extend(a,c)}})(chatease);
(function(d){var e=d.utils,f=d.events,a=d.core;d.embed.embedder=function(c,b){function d(a){g.dispatchEvent(a.type,a)}var g=e.extend(this,new f.eventdispatcher("embed.embedder"));g.embed=function(){var e=new a.entity(b);e.addGlobalListener(d);e.setup();c.setEntity(e,b.render.name)}}})(chatease);