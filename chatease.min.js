chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="1.0.08";
(function(a){var b=a.utils={};b.exists=function(c){switch(b.typeOf(c)){case "string":return 0<c.length;case "object":return null!==c;case "null":return!1}return!0};b.extend=function(){var c=Array.prototype.slice.call(arguments,0),d=c[0];if(1<c.length)for(var e=1;e<c.length;e++)b.foreach(c[e],function(c,b){void 0!==b&&null!==b&&(d[c]=b)});return d};b.foreach=function(c,d){for(var e in c)c.hasOwnProperty&&"function"===b.typeOf(c.hasOwnProperty)?c.hasOwnProperty(e)&&d(e,c[e]):d(e,c[e])};b.getCookie=
function(c){var b;return(b=document.cookie.match(new RegExp("(^| )"+c+"=([^;]*)(;|$)")))?unescape(b[2]):null};b.formatTime=function(c){var d=c.getHours()+1,e=c.getMinutes(),a=c.getSeconds();return c.toLocaleDateString()+" "+b.pad(d,2)+":"+b.pad(e,2)+":"+b.pad(a,2)};b.pad=function(b,d){for(b+="";b.length<d;)b="0"+b;return b};b.createElement=function(b,d){b=document.createElement(b);d&&(b.className=d);return b};b.addClass=function(c,d){var e="string"===b.typeOf(c.className)?c.className.split(" "):[];
d="array"===b.typeOf(d)?d:d.split(" ");b.foreach(d,function(c,d){-1===b.indexOf(e,d)&&e.push(d)});c.className=b.trim(e.join(" "))};b.removeClass=function(c,d){var e="string"===b.typeOf(c.className)?c.className.split(" "):[];d="array"===b.typeOf(d)?d:d.split(" ");b.foreach(d,function(c,d){c=b.indexOf(e,d);0<=c&&e.splice(c,1)});c.className=b.trim(e.join(" "))};b.emptyElement=function(b){for(;b.firstChild;)b.removeChild(b.firstChild)};b.typeOf=function(b){if(null===b||void 0===b)return"null";var d=typeof b;
if("object"===d)try{if("[object Array]"===toString.call(b))return"array"}catch(e){}return d};b.trim=function(b){return b.replace(/^\s+|\s+$/g,"")};b.indexOf=function(b,d){if(null==b)return-1;for(var e=0;e<b.length;e++)if(b[e]===d)return e;return-1};b.isMSIE=function(b){return b?(b=parseFloat(b).toFixed(1),b=new RegExp("msie\\s*"+b,"i"),null!==navigator.userAgent.toLowerCase().match(b)):null!==navigator.userAgent.toLowerCase().match(/msie/i)};var f=window.console=window.console||{log:function(){}};
b.log=function(){var a=Array.prototype.slice.call(arguments,0);"object"===b.typeOf(f.log)?f.log(a):f.log.apply(f,a)}})(chatease);
(function(a){function b(){var b=document.createElement("style");b.type="text/css";document.getElementsByTagName("head")[0].appendChild(b);return b.sheet||b.styleSheet}var f=a.utils,c;(f.css=function(d,e){c||(c=b());var a="";f.foreach(e,function(b,e){a+=b+": "+e+"; "});try{c.insertRule?c.insertRule(d+" { "+a+"}",c.cssRules.length):c.addRule(d,a,c.rules.length)}catch(g){f.log("Failed to insert css rule: "+d)}}).style=function(b,e,a){if(void 0!==b&&null!==b)for(void 0===b.length&&(b=[b]),e=f.extend({},
e),a=0;a<b.length;a++){var d=b[a];void 0!==d&&null!==d&&f.foreach(e,function(b,e){b=b.split("-");for(var a=1;a<b.length;a++)b[a]=b[a].charAt(0).toUpperCase()+b[a].slice(1);b=b.join("");d.style[b]!==e&&(d.style[b]=e)})}}})(chatease);(function(a){var b=a.utils;b.filter=function(a){var c,d="";this.replace=function(b){return d&&c?b.replace(c,"**"):b};"string"==b.typeOf(a)&&a&&(d=a,c=new RegExp(d,"ig"))}})(chatease);
(function(a){a.events={ERROR:"error",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_PROPERTY:"chateaseProperty",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_USERS:"chateaseUsers",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_PROPERTY:"chateaseViewProperty",
CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(a){var b=a.utils;a.events.eventdispatcher=function(f){function c(a,e,d){if(a)for(var c=0;c<a.length;c++){var h=a[c];if(h){null!==h.count&&0===--h.count&&delete a[c];try{h.listener(e)}catch(q){b.log('Error handling "'+d+'" event listener ['+c+"]: "+q.toString(),h.listener,e)}}}}var d={},e=[];this.addEventListener=function(a,e,c){try{b.exists(d[a])||(d[a]=[]),"string"===b.typeOf(e)&&(e=(new Function("return "+e))()),d[a].push({listener:e,count:c||null})}catch(v){b.log("error",v)}return!1};
this.removeEventListener=function(a,e){if(d[a]){try{if(void 0===e){d[a]=[];return}var c;for(c=0;c<d[a].length;c++)if(d[a][c].listener.toString()===e.toString()){d[a].splice(c,1);break}}catch(v){b.log("error",v)}return!1}};this.addGlobalListener=function(a,c){try{"string"===b.typeOf(a)&&(a=(new Function("return "+a))()),e.push({listener:a,count:c||null})}catch(k){b.log("error",k)}return!1};this.removeGlobalListener=function(a){if(a){try{var c;for(c=e.length-1;0<=c;c--)e[c].listener.toString()===a.toString()&&
e.splice(c,1)}catch(k){b.log("error",k)}return!1}};this.dispatchEvent=function(n,g){g||(g={});b.extend(g,{id:f,version:a.version,type:n});a.debug&&b.log(n,g);c(d[n],g,n);c(e,g,n)}}})(chatease);
(function(a){var b=a.utils,f=a.events,c={},d={onError:f.ERROR,onReady:f.CHATEASE_READY,onConnect:f.CHATEASE_CONNECT,onIdent:f.CHATEASE_INDENT,onMessage:f.CHATEASE_MESSAGE,onJoin:f.CHATEASE_JOIN,onLeft:f.CHATEASE_LEFT,onUsers:f.CHATEASE_USERS,onNickClick:f.CHATEASE_VIEW_NICKCLICK,onClose:f.CHATEASE_CLOSE};a.api=function(e){function c(b){g.dispatchEvent(b.type,b)}var g=b.extend(this,new f.eventdispatcher("api")),k;g.container=e;g.id=e.id;g.setup=function(e){b.emptyElement(g.container);a.debug=!!e.debug;
g.config=e;g.config.id=g.id;g.embedder=new a.embed(g);g.embedder.addGlobalListener(c);g.embedder.embed();return g};g.setEntity=function(b,a){k=b;g.onSWFLoaded=k.setup;g.onSWFOpen=k.onSWFOpen;g.onSWFMessage=k.onSWFMessage;g.onSWFError=k.onSWFError;g.onSWFClose=k.onSWFClose;g.send=k.send;g.resize=k.resize};(function(){b.foreach(d,function(b,a){g[b]=function(b){g.addEventListener(a,b)}})})()};a.api.getInstance=function(e){var d;null==e?e=0:e.nodeType?d=e:"string"===b.typeOf(e)&&(d=document.getElementById(e));
if(d){var f=c[d.id];f||(c[e]=f=new a.api(d));return f}return"number"===b.typeOf(e)?c[e]:null};a.api.displayError=function(b,a){}})(chatease);(function(a){a.core={}})(chatease);(function(a){a.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);
(function(a){a.core.protocol={};a=a.core.protocol;a.cmds={TEXT:"text",MUTE:"mute",KICKOUT:"kickout",PING:"ping"};a.raws={IDENT:"ident",TEXT:"text",JOIN:"join",LEFT:"left",USERS:"users",MUTE:"mute",KICKOUT:"kickout",ERROR:"error",PONG:"pong"};a.roles={VISITOR:0,NORMAL:1,VIP:14,ASSISTANT:16,SECRETARY:32,ANCHOR:48,ADMIN:64,SU_ADMIN:128,SYSTEM:192};a.channelStates={NORMAL:0,MUTED:1,LOCKED:3};a.punishments={MUTED:1,KICKED_OUT:3};a.errors={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDED:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,
REQUEST_TIMEOUT:408,CONFLICT:409,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504}})(chatease);(function(a){a.core.skins={}})(chatease);(function(a){a.core.skins.modes={DEFAULT:"def"}})(chatease);
(function(a){var b=a.utils,f=a.events;a=a.core.skins;var c=a.modes,d=b.css,e="cha-skin";a.def=function(a){a=b.extend(this,new f.eventdispatcher("skins.def"));a.resize=function(b,a){};a.name=c.DEFAULT;e+="-"+a.name;d(".cha-wrapper",{width:"100%",height:"100%"});d(".cha-wrapper *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});d("."+e+" .cha-button",{padding:".6rem 1.4rem","font-style":"normal",
"font-weight":"normal","text-align":"center","text-transform":"uppercase","white-space":"nowrap","word-spacing":"normal",border:"none","border-radius":".1875rem",cursor:"pointer",display:"inline-block","-webkit-font-smoothing":"subpixel-antialiased","-moz-osx-font-smoothing":"grayscale",transition:"150ms ease-in-out","transition-property":"background-color, color"});d("."+e+" .cha-button.red",{color:"#FFFFFF","background-color":"#FF0046"});d("."+e+" .cha-button.red:hover",{"background-color":"#97052D"});
d("."+e+" .cha-render",{width:"100%",height:"100%",display:"flex","flex-flow":"column nowrap"});d("."+e+" .cha-render .cha-title",{width:"100%",flex:"0 0 40px","font-family":"inherit","font-weight":"normal","text-align":"center","line-height":"40px",color:"#E6E6E6","background-color":"#171717",cursor:"not-allowed","pointer-events":"none"});d("."+e+" .cha-render .cha-console",{flex:"0 0 calc(100% - 140px)",color:"#242424","background-color":"#F8F8F8","overflow-y":"scroll"});d("."+e+" .cha-render .cha-console > div",
{margin:"6px","word-break":"break-all","word-wrap":"break-word"});d("."+e+" .cha-render .cha-console > div.cha-system > a",{"font-style":"normal","font-weight":"bold",color:"#FF0046"});d("."+e+" .cha-render .cha-console > div > span.ico-visitor",{"margin-right":"6px"});d("."+e+" .cha-render .cha-console > div > span.ico-normal",{"margin-right":"6px"});d("."+e+" .cha-render .cha-console > div > a",{"margin-right":"6px",color:"#0B7EF4","text-decoration":"none",cursor:"pointer"});d("."+e+" .cha-render .cha-controls",
{width:"100%",flex:"0 0 40px","line-height":"100%",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"stretch","background-color":"#171717",overflow:"hidden"});d("."+e+" .cha-render .cha-controls > *",{margin:"6px 0","text-align":"center",display:"block"});d("."+e+" .cha-render .cha-controls > .cha-checkbox",{color:"#E6E6E6",cursor:"pointer",overflow:"hidden"});d("."+e+" .cha-render .cha-controls > .cha-checkbox > label",{height:"100%",display:"flex","flex-flow":"row nowrap",
"justify-content":"space-between","align-items":"center",cursor:"pointer"});d("."+e+" .cha-render .cha-controls > .cha-checkbox input[type=checkbox]",{"margin-right":"6px",cursor:"pointer"});d("."+e+" .cha-render .cha-controls .shieldtext",{"float":"left"});d("."+e+" .cha-render .cha-controls .clearscreen",{"float":"right",width:"3rem"});d("."+e+" .cha-render .cha-dialog",{width:"100%",flex:"0 0 60px",overflow:"hidden"});d("."+e+" .cha-render .cha-dialog .cha-input",{width:"100%",height:"100%",display:"flex",
"flex-flow":"row nowrap","justify-content":"space-between","align-items":"stretch",overflow:"hidden"});d("."+e+" .cha-render .cha-dialog .cha-input textarea",{"margin-right":"6px",padding:"6px 10px",flex:"1 1 calc(100% - 3rem)",resize:"none",border:"0 none","background-color":"#E6E6E6"});d("."+e+" .cha-render .cha-dialog .cha-input button",{flex:"0 0 3rem"})}})(chatease);(function(a){a.core.renders={}})(chatease);(function(a){a.core.renders.modes={DEFAULT:"def"}})(chatease);
(function(a){var b=a.utils,f=a.events;a=a.core;var c=a.protocol.roles;a=a.renders;var d=a.modes;a.def=function(a,n){function e(a,e,c,d,f){e=b.createElement("div",e);var x=b.createElement("label");e.appendChild(x);var y=b.createElement("input");x.appendChild(y);y.setAttribute("type","checkbox");y.checked=!!f;c=function(a,c){return function(e){h.dispatchEvent(a,b.extend({value:y.checked},c))}}(c,d);try{y.addEventListener("change",c)}catch(E){y.attachEvent("onchange",c)}c=b.createElement("a");x.appendChild(c);
c.innerHTML=a;return e}function k(a,c,e,d){c=b.createElement("div",c);var f=b.createElement("a");c.appendChild(f);f.innerHTML=a;a=function(b,a){return function(c){h.dispatchEvent(b,a)}}(e,d);try{f.addEventListener("click",a)}catch(x){f.attachEvent("onclick",a)}return c}function v(a){var e="";return"number"!=b.typeOf(a)&&(a=parseInt(a),NaN==a||0>a)?"":e=a&c.SYSTEM?(a&c.SYSTEM)==c.SYSTEM?e+"ico-system":a&c.SU_ADMIN?e+"ico-suadmin":e+"ico-admin":a&c.ANCHOR?(a&c.ANCHOR)==c.ANCHOR?e+"ico-anchor":a&c.SECRETARY?
e+"ico-secretary":e+"ico-assistant":a&c.VIP?e+("ico-vip"+((a&c.VIP)-1)):(a&c.NORMAL)==c.NORMAL?e+"ico-normal":e+"ico-visitor"}var h=b.extend(this,new f.eventdispatcher("renders.def")),q,p,w,z,l,r,u;h.setup=function(){b.isMSIE(8)||b.isMSIE(9)?_object.setup&&(h.config.debug=!1,_object.setup(h.config),h.dispatchEvent(f.CHATEASE_READY,{id:h.config.id})):h.dispatchEvent(f.CHATEASE_READY,{id:h.config.id})};h.show=function(a,e,d){"object"!=b.typeOf(e)&&(e={id:0,name:"[\u7cfb\u7edf]",role:c.SYSTEM});"uni"!=
d&&(d="multi");var g=b.createElement("div");e.role&c.SYSTEM&&(g.className="cha-system");"uni"==d&&(d=b.createElement("span"),d.innerHTML="[\u5bc6\u8bed]",g.appendChild(d));if(d=v(e.role))d=b.createElement("span",d),g.appendChild(d);d=b.createElement("a");d.innerHTML=e.name;e=function(b){return function(a){h.dispatchEvent(f.CHATEASE_VIEW_NICKCLICK,{user:b})}}(e);try{d.addEventListener("click",e)}catch(B){d.attachEvent("onclick",e)}g.appendChild(d);g.insertAdjacentHTML("beforeend",a);p.childNodes.length>=
h.config.maxrecords&&p.removeChild(p.childNodes[0]);p.appendChild(g);p.scrollTop=p.scrollHeight};h.send=function(){h.dispatchEvent(f.CHATEASE_VIEW_SEND,{data:{data:r.value,type:"multi"}});h.clearInput()};h.clearInput=function(){r.value=""};h.clearScreen=function(){b.emptyElement(p)};h.element=function(){return _object};h.resize=function(b,a){};h.destroy=function(){};h.name=d.DEFAULT;h.config=b.extend({},{},n);if(b.isMSIE(8)||b.isMSIE(9))a.innerHTML='<object id="cha-swf" name="cha-swf" align="middle" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"><param name="movie" value="'+
h.config.swf+'"><param name="quality" value="high"><param name="bgcolor" value="#ffffff"><param name="allowscriptaccess" value="sameDomain"><param name="allowfullscreen" value="true"><param name="wmode" value="transparent"><param name="FlashVars" value="id='+h.config.id+'"></object>',_object=h.WebSocket=a.firstChild,_object.style.width=_object.style.height="0";(function(){q=b.createElement("div","cha-title");a.appendChild(q);q.innerHTML="\u804a\u5929\u5ba4";p=b.createElement("div","cha-console");
a.appendChild(p);w=b.createElement("div","cha-controls");a.appendChild(w);var c=e("\u5c4f\u853d\u6d88\u606f","cha-checkbox shieldtext",f.CHATEASE_VIEW_PROPERTY,{key:"shield"},!1);w.appendChild(c);c=k("\u6e05\u5c4f","cha-button red clearscreen",f.CHATEASE_VIEW_CLEARSCREEN,null);w.appendChild(c);z=b.createElement("div","cha-dialog");a.appendChild(z);l=b.createElement("div","cha-input");z.appendChild(l);r=b.createElement("textarea");l.appendChild(r);u=b.createElement("button","cha-button red");l.appendChild(u);
r.setAttribute("placeholder","\u8f93\u5165\u804a\u5929\u5185\u5bb9");h.config.maxlength&&r.setAttribute("maxlength",h.config.maxlength);c=function(){return function(b){b=window.event||b;13==b.keyCode&&(b.ctrlKey?r.value+="\r\n":(h.send(),window.event?b.returnValue=!1:b.preventDefault()))}}();try{r.addEventListener("keypress",c)}catch(A){r.attachEvent("onkeypress",c)}u.innerHTML="\u53d1\u9001";c=function(){return function(){h.send()}}();try{u.addEventListener("click",c)}catch(A){u.attachEvent("onclick",
c)}})()}})(chatease);
(function(a){var b=a.utils,f=a.events,c=a.core;c.entity=function(a){var e=b.extend(this,new f.eventdispatcher("core.entity")),d,g,k;e.setup=function(){setTimeout(function(){k.setup()},0)};e.destroy=function(){k&&k.stop();g&&g.destroy();d&&d.destroy()};e.id=a.id;e.model=d=new c.model(a);e.view=g=new c.view(d);e.controller=k=new c.controller(d,g);k.addGlobalListener(function(b){e.dispatchEvent(b.type,b)});e.onSWFOpen=k.onOpen;e.onSWFMessage=k.onMessage;e.onSWFError=k.onError;e.onSWFClose=k.onClose;
e.send=k.send;e.getState=d.getState;e.resize=g.resize}})(chatease);
(function(a){var b=a.utils,f=a.events;a=a.core;var c=a.states,d=a.protocol,e=d.roles,n=d.channelStates,g=d.punishments,k=function(){var a=this;_interval=-1;_active=0;a.set=function(c){b.extend(a,c);1==c.hasOwnProperty("role")&&(c=c.role,_interval=0>c?-1:c>=e.ASSISTANT?0:c&e.VIP?500:c==e.NORMAL?1E3:2E3)};a.isMuted=function(){return!!(a.state&n.MUTED|a.punishment.code&g.MUTED)};a.isActive=function(){if(0>_interval)return!1;var b=(new Date).getTime();if(_active&&b-_active<_interval)return!1;_active=
b;return!0};b.extend(a,{channel:null,role:-1,state:0,punishment:{code:0,time:0}})};a.model=function(a){var e=b.extend(this,new f.eventdispatcher("core.model")),d=c.CLOSED,g;e.setState=function(b){b!==d&&(d=b,e.dispatchEvent(f.CHATEASE_STATE,{state:b}))};e.getState=function(){return d};e.setProperty=function(b,a){1==g.hasOwnProperty(b)&&(g[b]=a,e.dispatchEvent(f.CHATEASE_PROPERTY,{key:b,value:a}))};e.getProperty=function(b){return g[b]};e.getConfig=function(b){return e.config[b]};e.destroy=function(){};
e.config=b.extend({},{},a);g={userinfo:new k,shield:!1}}})(chatease);
(function(a){var b=a.utils,f=a.events;a=a.core;var c=a.protocol.roles,d=a.renders,e=a.skins;a.view=function(a){function g(b){if(b.ctrlKey||b.metaKey)return!0;switch(b.keyCode){case 13:l&&l.send()}if(/13|32/.test(b.keyCode))return b.preventDefault?b.preventDefault():b.returnValue=!1,!1}function k(b){}function n(b){h(b)}function h(b){q.dispatchEvent(b.type,b)}var q=b.extend(this,new f.eventdispatcher("core.view")),p,w,z,l,r;q.setup=function(){l?l.setup():q.dispatchEvent(f.CHATEASE_SETUP_ERROR,{message:"Render not available!",
name:a.config.render.name})};q.show=function(b,e,d){(!e||e.role&c.SYSTEM||!a.getProperty("shield"))&&l&&l.show(b,e,d)};q.resize=function(b,a){l&&l.resize(b,a);r&&r.resize(b,a)};q.destroy=function(){p&&p.removeEventListener("keydown",g);l&&l.destroy()};(function(){p=b.createElement("div","cha-wrapper cha-skin-"+a.getConfig("skin").name);p.id=a.getConfig("id");p.tabIndex=0;w=b.createElement("div","cha-render");z=b.createElement("div","cha-contextmenu");p.appendChild(w);p.appendChild(z);var c=b.extend({},
a.getConfig("render"),{id:a.getConfig("id"),url:a.getConfig("url"),width:a.getConfig("width"),height:a.getConfig("height"),maxlength:a.getConfig("maxlength"),maxrecords:a.getConfig("maxrecords")});try{l=q.render=new d[c.name](w,c),l.addEventListener(f.CHATEASE_READY,h),l.addEventListener(f.CHATEASE_VIEW_SEND,h),l.addEventListener(f.CHATEASE_VIEW_PROPERTY,h),l.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,h),l.addEventListener(f.CHATEASE_VIEW_NICKCLICK,h),l.addEventListener(f.CHATEASE_RENDER_ERROR,
n)}catch(m){b.log("Failed to init render "+c.name+"!")}c=b.extend({},a.getConfig("skin"),{id:a.getConfig("id"),width:a.config.width,height:a.config.height});try{r=new e[c.name](c)}catch(m){b.log("Failed to init skin "+c.name+"!")}c=document.getElementById(a.getConfig("id"));c.parentNode.replaceChild(p,c);try{p.addEventListener("keydown",g),window.addEventListener("resize",k)}catch(m){p.attachEvent("onkeydown",g),window.attachEvent("onresize",k)}})()}})(chatease);
(function(a){var b=a.utils,f=a.events;a=a.core;var c=a.states,d=a.protocol,e=d.cmds,n=d.raws,g=d.roles,k=d.channelStates,v=d.punishments,h=d.errors;a.controller=function(a,d){function p(){if(t&&a.getState()==c.CONNECTED)b.log("Websocket had connected already.");else{d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{window.WebSocket=window.WebSocket||window.MozWebSocket,window.WebSocket?(t=new WebSocket(a.config.url),t.onopen=m.onOpen,t.onmessage=m.onMessage,t.onerror=m.onError,t.onclose=m.onClose):
(t=d.render.WebSocket,t.connect())}catch(x){b.log("Failed to initialize websocket: "+x)}}}function q(a){var d="";if("number"!=b.typeOf(a)&&(a=parseInt(a),NaN==a||0>a))return"";a&g.SYSTEM?d=(a&g.SYSTEM)==g.SYSTEM?d+"[\u7cfb\u7edf]":a&g.SU_ADMIN?d+"[\u8d85\u7ba1]":d+"[\u7ba1\u7406\u5458]":a&g.ANCHOR?d=(a&g.ANCHOR)==g.ANCHOR?d+"[\u4e3b\u64ad]":a&g.SECRETARY?d+"[\u52a9\u7406]":d+"[\u623f\u7ba1]":a&g.VIP?d+="[VIP"+((a&g.VIP)-1)+"]":(a&g.NORMAL)!=g.NORMAL&&(d+="[\u6e38\u5ba2]");return d}function l(a,e){var c=
r(a);c&&d.show(c);var g={raw:"error",error:{code:a,explain:c}};b.foreach(e,function(a,b){"cmd"!=a&&"raw"!=a&&"error"!=a&&(g[a]=b)});m.dispatchEvent(f.ERROR,g)}function r(a){var b="";switch(a){case h.BAD_REQUEST:b="\u9519\u8bef\u8bf7\u6c42\uff01";break;case h.UNAUTHORIZED:b="\u8bf7\u5148\u767b\u5f55\uff01";break;case h.FORBIDDED:b="\u6743\u9650\u9519\u8bef\uff01";break;case h.NOT_FOUND:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case h.CONFLICT:b="\u64cd\u4f5c\u9891\u7e41\uff01";break;case h.INTERNAL_SERVER_ERROR:b=
"\u5185\u90e8\u9519\u8bef\uff01";break;case h.NOT_IMPLEMENTED:b="\u65e0\u6cd5\u8bc6\u522b\uff01";break;case h.BAD_GATEWAY:b="\u54cd\u5e94\u65e0\u6548\uff01";break;case h.SERVICE_UNAVAILABLE:b="\u670d\u52a1\u8fc7\u8f7d\uff01";break;case h.GATEWAY_TIMEOUT:b="\u7f51\u5173\u8d85\u65f6\uff01"}return b}function u(a){m.dispatchEvent(a.type,a)}var m=b.extend(this,new f.eventdispatcher("core.controller")),A=!1,t,C,B=0;m.setup=function(a){A||d.setup()};m.send=function(d){if(t&&a.getState()==c.CONNECTED)if("object"!=
b.typeOf(d)||0==d.hasOwnProperty("cmd"))l(h.BAD_REQUEST,d);else{var e=a.getProperty("userinfo");0==e.isActive()?l(h.CONFLICT,d):1==e.isMuted()?l(h.FORBIDDED,d):t.send(JSON.stringify(d))}else p()};m.onOpen=function(b){a.setState(c.CONNECTED)};m.onMessage=function(e){var c;try{c=eval("("+e.data+")")}catch(D){b.log("Failed to parse JSON. \nError: "+D+"\ndata: "+e.data);return}switch(c.raw){case n.IDENT:e=a.getProperty("userinfo");e.set(b.extend({},c.user,{channel:c.channel.id,state:c.channel.state}));
d.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+e.channel+"\uff09\u3002");e.state&k.MUTED&&d.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");if(e.punishment.code&v.MUTED){var g=new Date;g.setTime(e.punishment.time);d.show("\u60a8\u5df2\u88ab\u7981\u8a00\u81f3\uff08"+b.formatTime(g)+"\uff09\uff01")}m.dispatchEvent(f.CHATEASE_INDENT,c);break;case n.TEXT:try{C||(C=new b.filter(a.keywords)),c.data=C.replace(c.data)}catch(D){b.log("Failed to execute filter.")}d.show(c.data,
c.user,c.type);m.dispatchEvent(f.CHATEASE_MESSAGE,c);break;case n.JOIN:e=q(c.user.role);d.show((e?e+" ":"")+c.user.name+" \u8fdb\u5165\u623f\u95f4\u3002");m.dispatchEvent(f.CHATEASE_JOIN,c);break;case n.LEFT:e=q(c.user.role);d.show((e?e+" ":"")+c.user.name+" \u5df2\u79bb\u5f00\u3002");m.dispatchEvent(f.CHATEASE_LEFT,c);break;case n.USERS:m.dispatchEvent(f.CHATEASE_USERS,c);break;case n.ERROR:l(c.error.code,c);break;default:b.log("Unknown data type: "+c.raw+", ignored.")}};m.onError=function(b){a.setState(c.ERROR)};
m.onClose=function(b){a.setState(c.CLOSED)};m.close=function(){t&&t.close()};a.addEventListener(f.CHATEASE_STATE,function(b){switch(b.state){case c.CONNECTED:d.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");B=0;m.dispatchEvent(f.CHATEASE_CONNECT);break;case c.CLOSED:d.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");m.dispatchEvent(f.CHATEASE_CLOSE,{channel:{id:a.channel}});if(0>a.config.maxretries||B<a.config.maxretries)b=Math.ceil(a.config.retrydelay+5E3*Math.random()),d.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+
b/1E3+"\u79d2..."),B++,t=null,setTimeout(p,b);break;case c.ERROR:d.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");m.dispatchEvent(f.ERROR,{message:"Chat room error!",channel:{id:a.channel}});break;default:m.dispatchEvent(f.ERROR,{message:"Unknown model state!",state:b.state})}});a.addEventListener(f.CHATEASE_PROPERTY,function(a){u(a)});d.addEventListener(f.CHATEASE_READY,function(c){A||(b.log("Chat ready!"),A=!0,u(c),p(),window.onbeforeunload=function(b){t&&a.getState()})});d.addEventListener(f.CHATEASE_SETUP_ERROR,
function(b){a.setState(c.ERROR);u(b)});d.addEventListener(f.CHATEASE_VIEW_SEND,function(c){var f=c.data.data;if(f){0<=a.config.maxlength&&(f=f.substr(0,a.config.maxlength));var f=b.trim(f),g=a.getProperty("userinfo");m.send({cmd:e.TEXT,data:f,type:c.data.type,channel:{id:g.channel}})}else d.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});d.addEventListener(f.CHATEASE_VIEW_PROPERTY,function(b){a.setProperty(b.key,b.value)});d.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,function(a){d.render.clearScreen();
u(a)});d.addEventListener(f.CHATEASE_VIEW_NICKCLICK,function(b){var c=a.getProperty("userinfo");b.channel={id:c.channel,state:c.state};u(b)});d.addEventListener(f.CHATEASE_RENDER_ERROR,function(b){a.setState(c.ERROR);u(b)})}})(chatease);
(function(a){var b=a.utils,f=a.events,c=a.embed=function(d){function e(a){switch(a.type){case f.ERROR:case f.CHATEASE_SETUP_ERROR:case f.CHATEASE_RENDER_ERROR:n.errorScreen(a.message);n.dispatchEvent(f.ERROR,a);break;default:n.dispatchEvent(a.type,a)}}var n=b.extend(this,new f.eventdispatcher("embed")),g={},k=null,v=!1;n.embed=function(){try{g=new c.config(d.config),k=new c.embedder(d,g)}catch(h){b.log("Failed to init embedder!");n.dispatchEvent(f.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",
render:g.render.name});return}k.addGlobalListener(e);k.embed()};n.errorScreen=function(b){v||(v=!0,a.api.displayError(b,g))};(function(){b.foreach(d.config.events,function(a,c){a=d[a];"function"===b.typeOf(a)&&a.call(d,c)})})()}})(chatease);
(function(a){var b=a.utils,f=a.embed,c=a.core.renders.modes,d=a.core.skins.modes;f.config=function(a){return b.extend({},{url:"ws://"+window.location.host+"/ch1?token=123456",width:300,height:450,keywords:"",maxlength:30,maxrecords:50,maxretries:-1,retrydelay:3E3,render:{name:c.DEFAULT,swf:"swf/chatease.swf"},skin:{name:d.DEFAULT}},a)};f.config.addConfig=function(a,c){return b.extend(a,c)}})(chatease);
(function(a){var b=a.utils,f=a.events,c=a.core;a.embed.embedder=function(a,e){function d(a){g.dispatchEvent(a.type,a)}var g=b.extend(this,new f.eventdispatcher("embed.embedder"));g.embed=function(){var b=new c.entity(e);b.addGlobalListener(d);b.setup();a.setEntity(b,e.render.name)}}})(chatease);