chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="1.0.06";
(function(c){var e=c.utils={};e.exists=function(a){switch(e.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};e.extend=function(){var a=Array.prototype.slice.call(arguments,0),b=a[0];if(1<a.length)for(var d=1;d<a.length;d++)e.foreach(a[d],function(a,d){void 0!==d&&null!==d&&(b[a]=d)});return b};e.foreach=function(a,b){for(var d in a)a.hasOwnProperty&&"function"===e.typeOf(a.hasOwnProperty)?a.hasOwnProperty(d)&&b(d,a[d]):b(d,a[d])};e.getCookie=
function(a){var b;return(b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(b[2]):null};e.formatTime=function(a){var b=a.getHours()+1,d=a.getMinutes(),c=a.getSeconds();return a.toLocaleDateString()+" "+e.pad(b,2)+":"+e.pad(d,2)+":"+e.pad(c,2)};e.pad=function(a,b){for(a+="";a.length<b;)a="0"+a;return a};e.createElement=function(a,b){a=document.createElement(a);b&&(a.className=b);return a};e.addClass=function(a,b){var d="string"===e.typeOf(a.className)?a.className.split(" "):[];
b="array"===e.typeOf(b)?b:b.split(" ");e.foreach(b,function(b,a){-1===e.indexOf(d,a)&&d.push(a)});a.className=e.trim(d.join(" "))};e.removeClass=function(a,b){var d="string"===e.typeOf(a.className)?a.className.split(" "):[];b="array"===e.typeOf(b)?b:b.split(" ");e.foreach(b,function(b,a){b=e.indexOf(d,a);0<=b&&d.splice(b,1)});a.className=e.trim(d.join(" "))};e.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};e.typeOf=function(a){if(null===a||void 0===a)return"null";var b=typeof a;
if("object"===b)try{if("[object Array]"===toString.call(a))return"array"}catch(d){}return b};e.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};e.indexOf=function(a,b){if(null==a)return-1;for(var d=0;d<a.length;d++)if(a[d]===b)return d;return-1};e.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),a=new RegExp("msie\\s*"+a,"i"),null!==navigator.userAgent.toLowerCase().match(a)):null!==navigator.userAgent.toLowerCase().match(/msie/i)};var f=window.console=window.console||{log:function(){}};
e.log=function(){var a=Array.prototype.slice.call(arguments,0);"object"===e.typeOf(f.log)?f.log(a):f.log.apply(f,a)}})(chatease);
(function(c){function e(){var b=document.createElement("style");b.type="text/css";document.getElementsByTagName("head")[0].appendChild(b);return b.sheet||b.styleSheet}var f=c.utils,a;(f.css=function(b,d){a||(a=e());var c="";f.foreach(d,function(b,a){c+=b+": "+a+"; "});try{a.insertRule?a.insertRule(b+" { "+c+"}",a.cssRules.length):a.addRule(b,c,a.rules.length)}catch(g){f.log("Failed to insert css rule: "+b)}}).style=function(b,a,e){if(void 0!==b&&null!==b)for(void 0===b.length&&(b=[b]),a=f.extend({},
a),e=0;e<b.length;e++){var d=b[e];void 0!==d&&null!==d&&f.foreach(a,function(a,b){a=a.split("-");for(var e=1;e<a.length;e++)a[e]=a[e].charAt(0).toUpperCase()+a[e].slice(1);a=a.join("");d.style[a]!==b&&(d.style[a]=b)})}}})(chatease);(function(c){var e=c.utils;e.filter=function(c){var a,b="";this.replace=function(e){return b&&a?e.replace(a,"**"):e};"string"==e.typeOf(c)&&c&&(b=c,a=new RegExp(b,"ig"))}})(chatease);
(function(c){c.events={ERROR:"error",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_PROPERTY:"chateaseProperty",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_USERS:"chateaseUsers",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_PROPERTY:"chateaseViewProperty",
CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(c){var e=c.utils;c.events.eventdispatcher=function(f){function a(a,b,d){if(a)for(var c=0;c<a.length;c++){var h=a[c];if(h){null!==h.count&&0===--h.count&&delete a[c];try{h.listener(b)}catch(r){e.log('Error handling "'+d+'" event listener ['+c+"]: "+r.toString(),h.listener,b)}}}}var b={},d=[];this.addEventListener=function(a,d,c){try{e.exists(b[a])||(b[a]=[]),"string"===e.typeOf(d)&&(d=(new Function("return "+d))()),b[a].push({listener:d,count:c||null})}catch(u){e.log("error",u)}return!1};
this.removeEventListener=function(a,d){if(b[a]){try{if(void 0===d){b[a]=[];return}var c;for(c=0;c<b[a].length;c++)if(b[a][c].listener.toString()===d.toString()){b[a].splice(c,1);break}}catch(u){e.log("error",u)}return!1}};this.addGlobalListener=function(a,b){try{"string"===e.typeOf(a)&&(a=(new Function("return "+a))()),d.push({listener:a,count:b||null})}catch(n){e.log("error",n)}return!1};this.removeGlobalListener=function(a){if(a){try{var b;for(b=d.length-1;0<=b;b--)d[b].listener.toString()===a.toString()&&
d.splice(b,1)}catch(n){e.log("error",n)}return!1}};this.dispatchEvent=function(k,g){g||(g={});e.extend(g,{id:f,version:c.version,type:k});c.debug&&e.log(k,g);a(b[k],g,k);a(d,g,k)}}})(chatease);
(function(c){var e=c.utils,f=c.events,a={},b={onError:f.ERROR,onReady:f.CHATEASE_READY,onConnect:f.CHATEASE_CONNECT,onIdent:f.CHATEASE_INDENT,onMessage:f.CHATEASE_MESSAGE,onJoin:f.CHATEASE_JOIN,onLeft:f.CHATEASE_LEFT,onUsers:f.CHATEASE_USERS,onNickClick:f.CHATEASE_VIEW_NICKCLICK,onClose:f.CHATEASE_CLOSE};c.api=function(a){function d(a){g.dispatchEvent(a.type,a)}var g=e.extend(this,new f.eventdispatcher("api")),n;g.container=a;g.id=a.id;g.setup=function(a){e.emptyElement(g.container);c.debug=!!a.debug;
g.config=a;g.config.id=g.id;g.embedder=new c.embed(g);g.embedder.addGlobalListener(d);g.embedder.embed();return g};g.setEntity=function(a,b){n=a;g.renderName=b;g.send=n.send;g.resize=n.resize};(function(){e.foreach(b,function(a,b){g[a]=function(a){g.addEventListener(b,a)}})})()};c.api.getInstance=function(b){var d;null==b?b=0:b.nodeType?d=b:"string"===e.typeOf(b)&&(d=document.getElementById(b));if(d){var f=a[d.id];f||(a[b]=f=new c.api(d));return f}return"number"===e.typeOf(b)?a[b]:null};c.api.displayError=
function(a,b){}})(chatease);(function(c){c.core={}})(chatease);(function(c){c.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);
(function(c){c.core.protocol={};c=c.core.protocol;c.cmds={TEXT:"text",MUTE:"mute",KICKOUT:"kickout",PING:"ping"};c.raws={IDENT:"ident",TEXT:"text",JOIN:"join",LEFT:"left",USERS:"users",MUTE:"mute",KICKOUT:"kickout",ERROR:"error",PONG:"pong"};c.roles={VISITOR:0,NORMAL:1,VIP:14,ASSISTANT:16,SECRETARY:32,ANCHOR:48,ADMIN:64,SU_ADMIN:128,SYSTEM:192};c.channelStates={NORMAL:0,MUTED:1,LOCKED:3};c.punishments={MUTED:1,KICKED_OUT:3};c.errors={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDED:403,NOT_FOUND:404,METHOD_NOT_ALLOWED:405,
REQUEST_TIMEOUT:408,CONFLICT:409,INTERNAL_SERVER_ERROR:500,NOT_IMPLEMENTED:501,BAD_GATEWAY:502,SERVICE_UNAVAILABLE:503,GATEWAY_TIMEOUT:504}})(chatease);(function(c){c.core.skins={}})(chatease);(function(c){c.core.skins.modes={DEFAULT:"def"}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core.skins;var a=c.modes,b=e.css,d="cha-skin";c.def=function(c){c=e.extend(this,new f.eventdispatcher("skins.def"));c.resize=function(a,b){};c.name=a.DEFAULT;d+="-"+c.name;b(".cha-wrapper",{width:"100%",height:"100%"});b(".cha-wrapper *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});b("."+d+" .cha-button",{padding:".6rem 1.4rem","font-style":"normal",
"font-weight":"normal","text-align":"center","text-transform":"uppercase","white-space":"nowrap","word-spacing":"normal",border:"none","border-radius":".1875rem",cursor:"pointer",display:"inline-block","-webkit-font-smoothing":"subpixel-antialiased","-moz-osx-font-smoothing":"grayscale",transition:"150ms ease-in-out","transition-property":"background-color, color"});b("."+d+" .cha-button.red",{color:"#FFFFFF","background-color":"#FF0046"});b("."+d+" .cha-button.red:hover",{"background-color":"#97052D"});
b("."+d+" .cha-render",{width:"100%",height:"100%",display:"flex","flex-flow":"column nowrap"});b("."+d+" .cha-render .cha-title",{width:"100%",flex:"0 0 40px","font-family":"inherit","font-weight":"normal","text-align":"center","line-height":"40px",color:"#E6E6E6","background-color":"#171717",cursor:"not-allowed","pointer-events":"none"});b("."+d+" .cha-render .cha-console",{flex:"0 0 calc(100% - 140px)",color:"#242424","background-color":"#F8F8F8","overflow-y":"scroll"});b("."+d+" .cha-render .cha-console > div",
{margin:"6px","word-break":"break-all","word-wrap":"break-word"});b("."+d+" .cha-render .cha-console > div.cha-system > a",{"font-style":"normal","font-weight":"bold",color:"#FF0046"});b("."+d+" .cha-render .cha-console > div.cha-myself",{});b("."+d+" .cha-render .cha-console > div.cha-myself > a",{});b("."+d+" .cha-render .cha-console > div > span.ico-visitor",{"margin-right":"6px"});b("."+d+" .cha-render .cha-console > div > span.ico-normal",{"margin-right":"6px"});b("."+d+" .cha-render .cha-console > div > span.ico-vip1",
{});b("."+d+" .cha-render .cha-console > div > span.ico-vip2",{});b("."+d+" .cha-render .cha-console > div > span.ico-vip3",{});b("."+d+" .cha-render .cha-console > div > span.ico-vip4",{});b("."+d+" .cha-render .cha-console > div > span.ico-vip5",{});b("."+d+" .cha-render .cha-console > div > span.ico-vip6",{});b("."+d+" .cha-render .cha-console > div > span.ico-vip7",{});b("."+d+" .cha-render .cha-console > div > span.ico-assistant",{});b("."+d+" .cha-render .cha-console > div > span.ico-secretary",
{});b("."+d+" .cha-render .cha-console > div > span.ico-anchor",{});b("."+d+" .cha-render .cha-console > div > span.ico-admin",{});b("."+d+" .cha-render .cha-console > div > span.ico-suadmin",{});b("."+d+" .cha-render .cha-console > div > span.ico-system",{});b("."+d+" .cha-render .cha-console > div > a",{"margin-right":"6px",color:"#0B7EF4","text-decoration":"none",cursor:"pointer"});b("."+d+" .cha-render .cha-controls",{width:"100%",flex:"0 0 40px","line-height":"100%",display:"flex","flex-flow":"row nowrap",
"justify-content":"space-between","align-items":"stretch","background-color":"#171717",overflow:"hidden"});b("."+d+" .cha-render .cha-controls > *",{margin:"6px 0","text-align":"center",display:"block"});b("."+d+" .cha-render .cha-controls > .cha-checkbox",{color:"#E6E6E6",cursor:"pointer",overflow:"hidden"});b("."+d+" .cha-render .cha-controls > .cha-checkbox > label",{height:"100%",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"center",cursor:"pointer"});
b("."+d+" .cha-render .cha-controls > .cha-checkbox input[type=checkbox]",{"margin-right":"6px",cursor:"pointer"});b("."+d+" .cha-render .cha-controls > .cha-checkbox a",{});b("."+d+" .cha-render .cha-controls > .cha-button",{});b("."+d+" .cha-render .cha-controls .shieldtext",{"float":"left"});b("."+d+" .cha-render .cha-controls .clearscreen",{"float":"right",width:"3rem"});b("."+d+" .cha-render .cha-dialog",{width:"100%",flex:"0 0 60px",overflow:"hidden"});b("."+d+" .cha-render .cha-dialog .cha-input",
{width:"100%",height:"100%",display:"flex","flex-flow":"row nowrap","justify-content":"space-between","align-items":"stretch",overflow:"hidden"});b("."+d+" .cha-render .cha-dialog .cha-input textarea",{"margin-right":"6px",padding:"6px 10px",flex:"1 1 calc(100% - 3rem)",resize:"none",border:"0 none","background-color":"#E6E6E6"});b("."+d+" .cha-render .cha-dialog .cha-input button",{flex:"0 0 3rem"})}})(chatease);(function(c){c.core.renders={}})(chatease);(function(c){c.core.renders.modes={DEFAULT:"def"}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core;var a=c.protocol.roles;c=c.renders;var b=c.modes;c.def=function(d,c){function g(a,b,c,d,f){b=e.createElement("div",b);var g=e.createElement("label");b.appendChild(g);var w=e.createElement("input");g.appendChild(w);w.type="checkbox";w.checked=!!f;c=function(a,b){return function(c){h.dispatchEvent(a,e.extend({value:w.checked},b))}}(c,d);try{w.addEventListener("change",c)}catch(E){w.attachEvent("onchange",c)}c=e.createElement("a");g.appendChild(c);c.innerHTML=
a;return b}function k(a,b,c,d){b=e.createElement("div",b);var f=e.createElement("a");b.appendChild(f);f.innerHTML=a;a=function(a,b){return function(c){h.dispatchEvent(a,b)}}(c,d);try{f.addEventListener("click",a)}catch(B){f.attachEvent("onclick",a)}return b}function u(b){var c="";return"number"!=e.typeOf(b)&&(b=parseInt(b),NaN==b||0>b)?"":c=b&a.SYSTEM?(b&a.SYSTEM)==a.SYSTEM?c+"ico-system":b&a.SU_ADMIN?c+"ico-suadmin":c+"ico-admin":b&a.ANCHOR?(b&a.ANCHOR)==a.ANCHOR?c+"ico-anchor":b&a.SECRETARY?c+"ico-secretary":
c+"ico-assistant":b&a.VIP?c+("ico-vip"+((b&a.VIP)-1)):(b&a.NORMAL)==a.NORMAL?c+"ico-normal":c+"ico-visitor"}var h=e.extend(this,new f.eventdispatcher("renders.def")),r,l,x,z,m,p,y;h.setup=function(){h.dispatchEvent(f.CHATEASE_READY,{id:h.config.id})};h.show=function(b,c,d){"object"!=e.typeOf(c)&&(c={id:0,name:"[\u7cfb\u7edf]",role:a.SYSTEM});"uni"!=d&&(d="multi");var g=e.createElement("div");c.role&a.SYSTEM&&(g.className="cha-system");"uni"==d&&(d=e.createElement("span"),d.innerHTML="[\u5bc6\u8bed]",
g.appendChild(d));if(d=u(c.role))d=e.createElement("span",d),g.appendChild(d);d=e.createElement("a");d.innerHTML=c.name;c=function(a){return function(b){h.dispatchEvent(f.CHATEASE_VIEW_NICKCLICK,{user:a})}}(c);try{d.addEventListener("click",c)}catch(A){d.attachEvent("onclick",c)}g.appendChild(d);g.insertAdjacentHTML("beforeend",b);l.childNodes.length>=h.config.maxrecords&&l.removeChild(l.childNodes[0]);l.appendChild(g);l.scrollTop=l.scrollHeight};h.send=function(){h.dispatchEvent(f.CHATEASE_VIEW_SEND,
{data:{data:p.value,type:"multi"}});h.clearInput()};h.clearInput=function(){p.value=""};h.clearScreen=function(){e.emptyElement(l)};h.element=function(){return null};h.resize=function(a,b){};h.destroy=function(){};h.name=b.DEFAULT;h.config=e.extend({},{},c);(function(){r=e.createElement("div","cha-title");d.appendChild(r);r.innerHTML="\u804a\u5929\u5ba4";l=e.createElement("div","cha-console");d.appendChild(l);x=e.createElement("div","cha-controls");d.appendChild(x);var a=g("\u5c4f\u853d\u6d88\u606f",
"cha-checkbox shieldtext",f.CHATEASE_VIEW_PROPERTY,{key:"shield"},!1);x.appendChild(a);a=k("\u6e05\u5c4f","cha-button red clearscreen",f.CHATEASE_VIEW_CLEARSCREEN,null);x.appendChild(a);z=e.createElement("div","cha-dialog");d.appendChild(z);m=e.createElement("div","cha-input");z.appendChild(m);p=e.createElement("textarea");m.appendChild(p);y=e.createElement("button","cha-button red");m.appendChild(y);p.setAttribute("placeholder","\u8f93\u5165\u804a\u5929\u5185\u5bb9");h.config.maxlength&&p.setAttribute("maxlength",
h.config.maxlength);a=function(){return function(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?p.value+="\r\n":(h.send(),window.event?a.returnValue=!1:a.preventDefault()))}}();try{p.addEventListener("keypress",a)}catch(q){p.attachEvent("onkeypress",a)}y.innerHTML="\u53d1\u9001";a=function(){return function(){h.send()}}();try{y.addEventListener("click",a)}catch(q){y.attachEvent("onclick",a)}})()}})(chatease);
(function(c){var e=c.utils,f=c.events,a=c.core;a.entity=function(b){var c=e.extend(this,new f.eventdispatcher("core.entity")),k,g,n;c.setup=function(){setTimeout(function(){g.setup()},0)};c.destroy=function(){n&&n.stop();g&&g.destroy();k&&k.destroy()};c.id=b.id;c.model=k=new a.model(b);c.view=g=new a.view(k);c.controller=n=new a.controller(k,g);n.addGlobalListener(function(a){c.dispatchEvent(a.type,a)});c.send=n.send;c.getState=k.getState;c.resize=g.resize}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core;var a=c.states,b=c.protocol,d=b.roles,k=b.channelStates,g=b.punishments,n=function(){var a=this;_interval=-1;_active=0;a.set=function(b){e.extend(a,b);1==b.hasOwnProperty("role")&&(b=b.role,_interval=0>b?-1:b>=d.ASSISTANT?0:b&d.VIP?500:b==d.NORMAL?1E3:2E3)};a.isMuted=function(){return!!(a.state&k.MUTED|a.punishment.code&g.MUTED)};a.isActive=function(){if(0>_interval)return!1;var a=(new Date).getTime();if(_active&&a-_active<_interval)return!1;_active=
a;return!0};e.extend(a,{channel:null,role:-1,state:0,punishment:{code:0,time:0}})};c.model=function(b){var c=e.extend(this,new f.eventdispatcher("core.model")),d=a.CLOSED,g;c.setState=function(a){a!==d&&(d=a,c.dispatchEvent(f.CHATEASE_STATE,{state:a}))};c.getState=function(){return d};c.setProperty=function(a,b){1==g.hasOwnProperty(a)&&(g[a]=b,c.dispatchEvent(f.CHATEASE_PROPERTY,{key:a,value:b}))};c.getProperty=function(a){return g[a]};c.getConfig=function(a){return c.config[a]};c.destroy=function(){};
c.config=e.extend({},{},b);g={userinfo:new n,shield:!1}}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core;var a=c.protocol.roles,b=c.renders,d=c.skins;c.view=function(c){function g(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:m.send()}if(/13|32/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function k(a){}function u(a){h(a)}function h(a){r.dispatchEvent(a.type,a)}var r=e.extend(this,new f.eventdispatcher("core.view")),l,x,z,m,p;r.setup=function(){m?m.setup():r.dispatchEvent(f.CHATEASE_SETUP_ERROR,{message:"Render not available!",
name:c.config.render.name})};r.show=function(b,d,e){(!d||d.role&a.SYSTEM||!c.getProperty("shield"))&&m&&m.show(b,d,e)};r.resize=function(a,b){m&&m.resize(a,b);p&&p.resize(a,b)};r.destroy=function(){l&&l.removeEventListener("keydown",g);m&&m.destroy()};(function(){l=e.createElement("div","cha-wrapper cha-skin-"+c.getConfig("skin").name);l.id=c.getConfig("id");l.tabIndex=0;x=e.createElement("div","cha-render");z=e.createElement("div","cha-contextmenu");l.appendChild(x);l.appendChild(z);var a=e.extend({},
c.getConfig("render"),{id:c.getConfig("id"),width:c.getConfig("width"),height:c.getConfig("height"),maxlength:c.getConfig("maxlength"),maxrecords:c.getConfig("maxrecords")});try{m=r.render=new b[a.name](x,a),m.addEventListener(f.CHATEASE_READY,h),m.addEventListener(f.CHATEASE_VIEW_SEND,h),m.addEventListener(f.CHATEASE_VIEW_PROPERTY,h),m.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,h),m.addEventListener(f.CHATEASE_VIEW_NICKCLICK,h),m.addEventListener(f.CHATEASE_RENDER_ERROR,u)}catch(v){e.log("Failed to init render "+
a.name+"!")}a=e.extend({},c.getConfig("skin"),{id:c.getConfig("id"),width:c.config.width,height:c.config.height});try{p=new d[a.name](a)}catch(v){e.log("Failed to init skin "+a.name+"!")}a=document.getElementById(c.getConfig("id"));a.parentNode.replaceChild(l,a);try{l.addEventListener("keydown",g),window.addEventListener("resize",k)}catch(v){l.attachEvent("onkeydown",g),window.attachEvent("onresize",k)}})()}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core;var a=c.states,b=c.protocol,d=b.cmds,k=b.raws,g=b.roles,n=b.channelStates,u=b.punishments,h=b.errors;c.controller=function(b,c){function l(){if(t&&b.state!=a.CONNECTED)e.log("Websocket had connected already.");else{c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{t=window.WebSocket?new WebSocket(b.config.url):window.MozWebSocket?new MozWebSocket(b.config.url):new SockJS(b.config.url.replace(/^ws/,"http")+"/sockjs")}catch(w){e.log("Failed to initialize websocket: "+
w);return}t.onopen=function(c){b.setState(a.CONNECTED)};t.onmessage=r;t.onerror=function(c){b.setState(a.ERROR)};t.onclose=function(c){b.setState(a.CLOSED)}}}function r(a){var d;try{d=eval("("+a.data+")")}catch(D){e.log("Failed to parse JSON. \nError: "+D+"\ndata: "+a.data);return}switch(d.raw){case k.IDENT:a=b.getProperty("userinfo");a.set(e.extend({},d.user,{channel:d.channel.id,state:d.channel.state}));c.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+a.channel+"\uff09\u3002");a.state&n.MUTED&&c.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");
if(a.punishment.code&u.MUTED){var g=new Date;g.setTime(a.punishment.time);c.show("\u60a8\u5df2\u88ab\u7981\u8a00\u81f3\uff08"+e.formatTime(g)+"\uff09\uff01")}q.dispatchEvent(f.CHATEASE_INDENT,d);break;case k.TEXT:try{A||(A=new e.filter(b.keywords)),d.data=A.replace(d.data)}catch(D){e.log("Failed to execute filter.")}c.show(d.data,d.user,d.type);q.dispatchEvent(f.CHATEASE_MESSAGE,d);break;case k.JOIN:a=m(d.user.role);c.show((a?a+" ":"")+d.user.name+" \u8fdb\u5165\u623f\u95f4\u3002");q.dispatchEvent(f.CHATEASE_JOIN,
d);break;case k.LEFT:a=m(d.user.role);c.show((a?a+" ":"")+d.user.name+" \u5df2\u79bb\u5f00\u3002");q.dispatchEvent(f.CHATEASE_LEFT,d);break;case k.USERS:q.dispatchEvent(f.CHATEASE_USERS,d);break;case k.ERROR:p(d.error.code,d);break;default:e.log("Unknown data type: "+d.raw+", ignored.")}}function m(a){var b="";if("number"!=e.typeOf(a)&&(a=parseInt(a),NaN==a||0>a))return"";a&g.SYSTEM?b=(a&g.SYSTEM)==g.SYSTEM?b+"[\u7cfb\u7edf]":a&g.SU_ADMIN?b+"[\u8d85\u7ba1]":b+"[\u7ba1\u7406\u5458]":a&g.ANCHOR?b=(a&
g.ANCHOR)==g.ANCHOR?b+"[\u4e3b\u64ad]":a&g.SECRETARY?b+"[\u52a9\u7406]":b+"[\u623f\u7ba1]":a&g.VIP?b+="[VIP"+((a&g.VIP)-1)+"]":(a&g.NORMAL)!=g.NORMAL&&(b+="[\u6e38\u5ba2]");return b}function p(a,b){var d=y(a);d&&c.show(d);var g={raw:"error",error:{code:a,explain:d}};e.foreach(b,function(a,b){"cmd"!=a&&"raw"!=a&&"error"!=a&&(g[a]=b)});q.dispatchEvent(f.ERROR,g)}function y(a){var b="";switch(a){case h.BAD_REQUEST:b="\u9519\u8bef\u8bf7\u6c42\uff01";break;case h.UNAUTHORIZED:b="\u8bf7\u5148\u767b\u5f55\uff01";
break;case h.FORBIDDED:b="\u6743\u9650\u9519\u8bef\uff01";break;case h.NOT_FOUND:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case h.CONFLICT:b="\u64cd\u4f5c\u9891\u7e41\uff01";break;case h.INTERNAL_SERVER_ERROR:b="\u5185\u90e8\u9519\u8bef\uff01";break;case h.NOT_IMPLEMENTED:b="\u65e0\u6cd5\u8bc6\u522b\uff01";break;case h.BAD_GATEWAY:b="\u54cd\u5e94\u65e0\u6548\uff01";break;case h.SERVICE_UNAVAILABLE:b="\u670d\u52a1\u8fc7\u8f7d\uff01";break;case h.GATEWAY_TIMEOUT:b="\u7f51\u5173\u8d85\u65f6\uff01"}return b}
function v(a){q.dispatchEvent(a.type,a)}var q=e.extend(this,new f.eventdispatcher("core.controller")),C=!1,t,A,B=0;q.send=function(c){if(t&&b.state!=a.CLOSED)if("object"!=e.typeOf(c)||0==c.hasOwnProperty("cmd"))p(h.BAD_REQUEST,c);else{var d=b.getProperty("userinfo");0==d.isActive()?p(h.CONFLICT,c):1==d.isMuted()?p(h.FORBIDDED,c):t.send(JSON.stringify(c))}else l()};q.close=function(){t&&t.close()};b.addEventListener(f.CHATEASE_STATE,function(d){switch(d.state){case a.CONNECTED:c.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");
B=0;q.dispatchEvent(f.CHATEASE_CONNECT);break;case a.CLOSED:c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");q.dispatchEvent(f.CHATEASE_CLOSE,{channel:{id:b.channel}});if(0>b.config.maxretries||B<b.config.maxretries)d=Math.ceil(b.config.retrydelay+5E3*Math.random()),c.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+d/1E3+"\u79d2..."),B++,t=null,setTimeout(l,d);break;case a.ERROR:c.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");q.dispatchEvent(f.ERROR,{message:"Chat room error!",channel:{id:b.channel}});
break;default:q.dispatchEvent(f.ERROR,{message:"Unknown model state!",state:d.state})}});b.addEventListener(f.CHATEASE_PROPERTY,function(a){v(a)});c.addEventListener(f.CHATEASE_READY,function(c){C||(e.log("Chat ready!"),C=!0,v(c),l(),window.onbeforeunload=function(c){t&&b.state==a.CONNECTED&&t.close()})});c.addEventListener(f.CHATEASE_SETUP_ERROR,function(c){b.setState(a.ERROR);v(c)});c.addEventListener(f.CHATEASE_VIEW_SEND,function(a){var f=a.data.data;if(f){0<=b.config.maxlength&&(f=f.substr(0,
b.config.maxlength));var f=e.trim(f),g=b.getProperty("userinfo");q.send({cmd:d.TEXT,data:f,type:a.data.type,channel:{id:g.channel}})}else c.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});c.addEventListener(f.CHATEASE_VIEW_PROPERTY,function(a){b.setProperty(a.key,a.value)});c.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,function(a){c.render.clearScreen();v(a)});c.addEventListener(f.CHATEASE_VIEW_NICKCLICK,function(a){var c=b.getProperty("userinfo");a.channel={id:c.channel,state:c.state};v(a)});c.addEventListener(f.CHATEASE_RENDER_ERROR,
function(c){b.setState(a.ERROR);v(c)})}})(chatease);
(function(c){var e=c.utils,f=c.events,a=c.embed=function(b){function d(a){switch(a.type){case f.ERROR:case f.CHATEASE_SETUP_ERROR:case f.CHATEASE_RENDER_ERROR:k.errorScreen(a.message);k.dispatchEvent(f.ERROR,a);break;default:k.dispatchEvent(a.type,a)}}var k=e.extend(this,new f.eventdispatcher("embed")),g={},n=null,u=!1;k.embed=function(){try{g=new a.config(b.config),n=new a.embedder(b,g)}catch(h){e.log("Failed to init embedder!");k.dispatchEvent(f.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",
render:g.render.name});return}n.addGlobalListener(d);n.embed()};k.errorScreen=function(a){u||(u=!0,c.api.displayError(a,g))};(function(){e.foreach(b.config.events,function(a,c){a=b[a];"function"===e.typeOf(a)&&a.call(b,c)})})()}})(chatease);
(function(c){var e=c.utils,f=c.embed,a=c.core.renders.modes,b=c.core.skins.modes;f.config=function(c){return e.extend({},{url:"ws://"+window.location.host+"/ch1?token=123456",width:300,height:450,keywords:"",maxlength:30,maxrecords:50,maxretries:-1,retrydelay:3E3,render:{name:a.DEFAULT},skin:{name:b.DEFAULT}},c)};f.config.addConfig=function(a,b){return e.extend(a,b)}})(chatease);
(function(c){var e=c.utils,f=c.events,a=c.core;c.embed.embedder=function(b,c){function d(a){g.dispatchEvent(a.type,a)}var g=e.extend(this,new f.eventdispatcher("embed.embedder"));g.embed=function(){var e=new a.entity(c);e.addGlobalListener(d);e.setup();b.setEntity(e,c.render.name)}}})(chatease);