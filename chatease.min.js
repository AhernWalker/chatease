chatease=function(){return chatease.api?chatease.api.getInstance.apply(this,arguments):void 0};chatease.version="0.1.24";
(function(c){function e(a){return null!==navigator.userAgent.toLowerCase().match(a)}var f,b=c.utils={};b.exists=function(a){switch(b.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};b.extend=function(){var a,h=Array.prototype.slice.call(arguments,0),d=h[0];if(1<h.length)for(a=1;a<h.length;a++)b.foreach(h[a],function(a,b){void 0!==b&&null!==b&&(d[a]=b)});return d};b.foreach=function(a,h){for(var d in a)a.hasOwnProperty&&"function"===b.typeOf(a.hasOwnProperty)?
a.hasOwnProperty(d)&&h(d,a[d]):h(d,a[d])};b.getCookie=function(a){var b;return(b=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(b[2]):null};b.formatTime=function(a){var h=a.getHours()+1,d=a.getMinutes(),e=a.getSeconds();return a.toLocaleDateString()+" "+b.pad(h,2)+":"+b.pad(d,2)+":"+b.pad(e,2)};b.pad=function(a,b){for(var d=a+"";d.length<b;)d="0"+d;return d};b.createElement=function(a,b){var d=document.createElement(a);return b&&(d.className=b),d};b.addClass=function(a,h){var d=
"string"===b.typeOf(a.className)?a.className.split(" "):[],e="array"===b.typeOf(h)?h:h.split(" ");b.foreach(e,function(a,e){-1===b.indexOf(d,e)&&d.push(e)});a.className=b.trim(d.join(" "))};b.removeClass=function(a,e){var d="string"===b.typeOf(a.className)?a.className.split(" "):[],g="array"===b.typeOf(e)?e:e.split(" ");b.foreach(g,function(a,e){var h=b.indexOf(d,e);0<=h&&d.splice(h,1)});a.className=b.trim(d.join(" "))};b.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};b.typeOf=
function(a){if(null===a||void 0===a)return"null";var b=typeof a;if("object"===b)try{if("[object Array]"===toString.call(a))return"array"}catch(d){}return b};b.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};b.indexOf=function(a,b){if(null==a)return-1;for(var d=0;d<a.length;d++)if(a[d]===b)return d;return-1};b.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),e(new RegExp("msie\\s*"+a,"i"))):e(/msie/i)};f=window.console=window.console||{log:function(){}};b.log=function(){var a=Array.prototype.slice.call(arguments,
0);"object"===b.typeOf(f.log)?f.log(a):f.log.apply(f,a)}})(chatease);
(function(c){function e(){var a=document.createElement("style");return a.type="text/css",document.getElementsByTagName("head")[0].appendChild(a),a.sheet||a.styleSheet}var f,b=c.utils;(b.css=function(a,h){f||(f=e());var d="";b.foreach(h,function(a,b){d+=a+": "+b+"; "});try{f.insertRule?f.insertRule(a+" { "+d+"}",f.cssRules.length):f.addRule(a,d,f.rules.length)}catch(g){b.log("Failed to insert css rule: "+a)}}).style=function(a,e){var d,g,k;if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),d=b.extend({},
e),g=0;g<a.length;g++)k=a[g],void 0!==k&&null!==k&&b.foreach(d,function(a,b){var d;d=a.split("-");for(var e=1;e<d.length;e++)d[e]=d[e].charAt(0).toUpperCase()+d[e].slice(1);d=d.join("");k.style[d]!==b&&(k.style[d]=b)})}})(chatease);(function(c){var e=c.utils;e.filter=function(c){var b,a="";this.replace=function(e){return a&&b?e.replace(b,"**"):e};"string"==e.typeOf(c)&&c&&(a=c,b=new RegExp(a,"ig"))}})(chatease);
(function(c){c.events={ERROR:"ERROR",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_ERROR:"chateaseError",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_SHIELDMSG:"chateaseViewMsgShield",CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",
CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(c){var e=c.utils;c.events.eventdispatcher=function(f){function b(a,b,h){var c,f;if(a)for(c=0;c<a.length;c++)if(f=a[c]){null!==f.count&&0===--f.count&&delete a[c];try{f.listener(b)}catch(u){e.log('Error handling "'+h+'" event listener ['+c+"]: "+u.toString(),f.listener,b)}}}var a={},h=[];this.addEventListener=function(b,c,h){try{e.exists(a[b])||(a[b]=[]),"string"===e.typeOf(c)&&(c=(new Function("return "+c))()),a[b].push({listener:c,count:h||null})}catch(f){e.log("error",f)}return!1};this.removeEventListener=
function(b,c){if(a[b]){try{if(void 0===c)return a[b]=[],void 0;var h;for(h=0;h<a[b].length;h++)if(a[b][h].listener.toString()===c.toString()){a[b].splice(h,1);break}}catch(f){e.log("error",f)}return!1}};this.addGlobalListener=function(a,b){try{"string"===e.typeOf(a)&&(a=(new Function("return "+a))()),h.push({listener:a,count:b||null})}catch(c){e.log("error",c)}return!1};this.removeGlobalListener=function(a){if(a){try{var b;for(b=h.length-1;0<=b;b--)h[b].listener.toString()===a.toString()&&h.splice(b,
1)}catch(c){e.log("error",c)}return!1}};this.dispatchEvent=function(d,g){g||(g={});e.extend(g,{id:f,version:c.version,type:d});c.debug&&e.log(d,g);b(a[d],g,d);b(h,g,d)}}})(chatease);
(function(c){var e=c.utils,f=c.events,b={},a={onError:f.ERROR,onReady:f.CHATEASE_READY,onConnect:f.CHATEASE_CONNECT,onIdent:f.CHATEASE_INDENT,onMessage:f.CHATEASE_MESSAGE,onJoin:f.CHATEASE_JOIN,onLeft:f.CHATEASE_LEFT,onNickClick:f.CHATEASE_VIEW_NICKCLICK,onClose:f.CHATEASE_CLOSE};c.api=function(b){function d(a){k.dispatchEvent(a.type,a)}var g,k=e.extend(this,new f.eventdispatcher("api"));k.container=b;k.id=b.id;k.setup=function(a){return e.emptyElement(k.container),c.debug=!!a.debug,k.config=a,k.config.id=
k.id,k.embedder=new c.embed(k),k.embedder.addGlobalListener(d),k.embedder.embed(),k};k.setEntity=function(a,b){g=a;k.renderName=b;k.send=g.send;k.join=g.join;k.resize=g.resize};(function(){e.foreach(a,function(a,b){k[a]=function(a){k.addEventListener(b,a)}})})()};c.api.getInstance=function(a){var d,f;return null==a?a=0:a.nodeType?d=a:"string"===e.typeOf(a)&&(d=document.getElementById(a)),d?(f=b[d.id],f||(b[a]=f=new c.api(d)),f):"number"===e.typeOf(a)?b[a]:null};c.api.displayError=function(){}})(chatease);
(function(c){c.core={}})(chatease);(function(c){c.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);(function(c){c.core.renders={}})(chatease);(function(c){c.core.renders.modes={DEFAULT:"def"}})(chatease);(function(c){c.core.renders.skins={}})(chatease);(function(c){c.core.renders.skins.modes={DEFAULT:"def"}})(chatease);
(function(c){var e=c.utils,f=c.events,b=e.css;c.core.renders.skins.def=function(a){var c=e.extend(this,new f.eventdispatcher("skins.def"));b(".chatwrap",{width:a.width+"px",height:a.height+"px","box-shadow":"0 1px 1px rgba(0, 0, 0, 0.05)"});b(".chatwrap *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px","font-weight":"normal","box-sizing":"content-box"});b(".render",{width:a.width-2+"px",height:a.height-2+"px",border:"1px solid #1184ce","border-radius":"4px",
position:"relative"});b(" .title",{padding:"auto 12px",width:"100%",height:"34px","font-family":"inherit","font-weight":"normal",color:"#fff","text-align":"center","line-height":"34px","vertical-align":"middle","box-shadow":"none","background-color":"#1184ce",cursor:"not-allowed","pointer-events":"none"});b(" .title span",{top:"2px","margin-left":"2px"});b(" .main",{width:"100%",height:a.height-2-parseInt("34px")+"px"});b(" .main .console",{width:"100%",height:.75*(a.height-parseInt("34px"))+"px",
"max-height":"75%","overflow-y":"auto","background-color":"#f8f8f8"});b(" .main .console > div",{margin:"5px","word-break":"break-all","word-wrap":"break-word"});b(" .main .console > div > span",{"margin-right":"5px"});b(" .main .console > div > span.vip1",{});b(" .main .console > div > span.vip2",{});b(" .main .console > div > span.vip3",{});b(" .main .console > div > span.vip4",{});b(" .main .console > div > span.vip5",{});b(" .main .console > div > span.vip6",{});b(" .main .console > div > span.vip7",
{});b(" .main .console > div > span.temporary",{});b(" .main .console > div > span.manager",{});b(" .main .console > div > span.owner",{});b(" .main .console > div > span.system",{});b(" .main .console > div > span.admin",{});b(" .main .console > div > a",{"margin-right":"5px",color:"#1184ce","text-decoration":"none",cursor:"pointer"});b(" .main .console > div.system > a",{"font-style":"normal","font-weight":"bold",color:"red"});b(" .main .console > div.myself",{});b(" .main .console > div.myself > a",
{});b(" .main .dialog",{width:"100%",height:.25*(a.height-1-parseInt("34px"))+"px",position:"relative",overflow:"hidden"});b(" .main .dialog .control",{width:"100%",height:"38px",border:"1px solid #1184ce","border-width":"1px 0"});b(" .main .dialog .control > *",{margin:"0 5px",height:"100%","line-height":"38px","text-align":"center","vertical-align":"middle","box-sizing":"border-box",display:"inline-block"});b(" .main .dialog .control > div > .ch",{color:"#666","vertical-align":"middle",cursor:"pointer"});
b(" .main .dialog .control > div > .ch input[type=checkbox]",{"margin-right":"5px",cursor:"pointer"});b(" .main .dialog .control > div > .ch a",{});b(" .main .dialog .control > div > .btn",{padding:"3px 5px",color:"#fff","text-align":"center","vertical-align":"middle","border-radius":"3px","background-color":"#1184ce",cursor:"pointer"});b(" .main .dialog .control .msgshield",{"float":"left"});b(" .main .dialog .control .clrscreen",{"float":"right"});b(" .main .dialog .control .clrscreen span",{top:"2px",
"margin-left":"2px"});b(" .main .dialog .input",{position:"relative"});b(" .main .dialog .input textarea",{"float":"left",margin:"0",padding:"5px 10px",width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",resize:"none",border:"0 none","border-radius":"0 0 0 4px","box-sizing":"border-box",overflow:"auto"});b(" .main .dialog .input button",{"float":"left",padding:0,width:"46px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px",color:"#fff",
border:"0 none","box-sizing":"border-box","background-color":"#1184ce",cursor:"pointer"});e.isMSIE(7)&&(b(" .main .dialog .input textarea",{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),b(" .main .dialog .input button",{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}));c.resize=function(d,c){e.log("Resizing to "+d+", "+c);a.width=parseInt(d);a.height=parseInt(c);var f=document.getElementById(a.id),h=document.getElementById(a.prefix+
"render"),x=document.getElementById(a.prefix+"main"),u=document.getElementById(a.prefix+"console"),n=document.getElementById(a.prefix+"dialog"),q=document.getElementById(a.prefix+"input"),t=document.getElementById(a.prefix+"submit");b.style(f,{width:a.width+"px",height:a.height+"px"});b.style(h,{width:a.width-2+"px",height:a.height-2+"px"});b.style(x,{height:a.height-2-parseInt("34px")+"px"});b.style(u,{height:.75*(a.height-parseInt("34px"))+"px"});b.style(n,{height:.25*(a.height-1-parseInt("34px"))+
"px"});b.style(q,{width:a.width-2-parseInt("46px")+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});b.style(t,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")-2+"px"});e.isMSIE(7)&&(b.style(q,{width:a.width-2-parseInt("46px")-20+"px",height:.25*(a.height-parseInt("34px"))-parseInt("38px")-12+"px"}),b.style(t,{height:.25*(a.height-parseInt("34px"))-parseInt("38px")+"px"}))}}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core.renders;var b=c.skins,a=b.modes,h=(e.css,"render");c.def=function(d,c){function k(a){var b="";switch(e.typeOf(a)){case "string":if(a=parseInt(a),0/0==a||0>a)break;case "number":128&a?b="admin":64&a||(32&a?b="owner":16&a?b="manager":8&a&&(b="temporary")),7&a&&(b+=(b.length?" ":"")+"vip"+(7&a))}return b}function w(a){a=window.event||a;13==a.keyCode&&(a.ctrlKey?l.value+="\r\n":(m.send(),window.event?window.event.returnValue=!1:a.preventDefault()))}function x(){m.send()}
var u,n,q,t,r,v,p,l,y,m=e.extend(this,new f.eventdispatcher("renders.def"));q={minWidth:300,minHeight:340,skin:{name:a.DEFAULT},prefix:"chat-"};m.show=function(a,b){var c,h,l,y=e.createElement("div");switch(e.typeOf(a)){case "object":c=a.text;"uni"==a.type&&(h=e.createElement("span"),h.innerHTML="[\u5bc6\u8bed]",y.appendChild(h));break;default:c=a}switch(e.typeOf(b)){case "string":if(""===b)break;b={id:0,name:b,channel:{id:0,role:0,state:3}};case "null":b={id:0,name:"[\u7cfb\u7edf]",channel:{id:0,
role:64,state:3}};case "object":if(null==e.typeOf(b.id))break;(h=0<=b.channel.role&&64&b.channel.role?"system":b.id==d.user().id?"myself":"")&&(y.className=h);(h=k(b.channel.role))&&(l=e.createElement("span",h),l.innerHTML=h.substr(0,1),y.appendChild(l));l=e.createElement("a");l.user=e.extend({},b);l.innerHTML=b.name;try{l.addEventListener("click",function(){m.dispatchEvent(f.CHATEASE_VIEW_NICKCLICK,{user:{id:this.user.id,name:this.user.name},channel:this.user.channel})})}catch(g){l.attachEvent("onclick",
function(){m.dispatchEvent(f.CHATEASE_VIEW_NICKCLICK,{user:{id:this.user.id,name:this.user.name},channel:this.user.channel})})}y.appendChild(l)}y.insertAdjacentHTML("beforeend",c);t.childNodes.length>=m.config.maxRecords&&t.removeChild(t.childNodes[0]);t.appendChild(y);t.scrollTop=t.scrollHeight};m.send=function(){for(var a=0;a<m.config.channel.length;a++)m.dispatchEvent(f.CHATEASE_VIEW_SEND,{data:{text:l.value,type:"multi",channel:m.config.channel[a]}});m.clearInput()};m.clearInput=function(){l.value=
""};m.clearScreen=function(){e.emptyElement(t)};m.element=function(){return u};m.resize=function(a,b){a=a||u.offsetWidth||c.width;b=b||u.offsetHeight||c.height;y&&y.resize(Math.max(a,m.config.minWidth),Math.max(b,m.config.minHeight))};m.destroy=function(){};m.config=e.extend({},q,c);m.config.width=Math.max(m.config.width,m.config.minWidth);m.config.height=Math.max(m.config.height,m.config.minHeight);u=e.createElement("div",h);n=e.createElement("div","title");q=e.createElement("div","main");u.appendChild(n);
u.appendChild(q);t=e.createElement("div","console");r=e.createElement("div","dialog");q.appendChild(t);q.appendChild(r);v=e.createElement("div","control");p=e.createElement("div","input");r.appendChild(v);r.appendChild(p);n.innerHTML="\u804a\u5929\u5ba4";(function(a,b,c,d,f){a=e.createElement("div",a);var h=e.createElement("label","ch"),l=e.createElement("input");l.type="checkbox";l.checked=!!f;try{l.addEventListener("change",function(){m.dispatchEvent(b,e.extend({shield:l.checked},c))})}catch(y){l.attachEvent("onchange",
function(){m.dispatchEvent(b,e.extend({shield:l.checked},c))})}h.appendChild(l);f=e.createElement("a");f.innerHTML=d;h.appendChild(f);a.appendChild(h);v.appendChild(a)})("msgshield",f.CHATEASE_VIEW_SHIELDMSG,null,"\u5c4f\u853d\u6d88\u606f",!1);(function(a,b,c,d){a=e.createElement("div",a);var f=e.createElement("a","btn");f.innerHTML=d;try{f.addEventListener("click",function(){m.dispatchEvent(b,c)})}catch(l){f.attachEvent("onclick",function(){m.dispatchEvent(b,c)})}a.appendChild(f);v.appendChild(a)})("clrscreen",
f.CHATEASE_VIEW_CLEARSCREEN,null,"\u6e05\u5c4f","glyphicon glyphicon-trash");l=e.createElement("textarea");l.setAttribute("placeholder","\u8f93\u5165\u804a\u5929\u5185\u5bb9");m.config.maxlength&&l.setAttribute("maxlength",m.config.maxlength);try{l.addEventListener("keypress",w)}catch(z){l.attachEvent("onkeypress",w)}p.appendChild(l);n=e.createElement("button");n.innerHTML="\u53d1\u9001";try{n.addEventListener("click",x)}catch(z){n.attachEvent("onclick",x)}p.appendChild(n);u.id=m.config.prefix+h;
q.id=m.config.prefix+"main";t.id=m.config.prefix+"console";r.id=m.config.prefix+"dialog";l.id=m.config.prefix+"input";n.id=m.config.prefix+"submit";try{y=new b[m.config.skin.name](m.config)}catch(z){e.log("Failed to init skin["+m.config.skin.name+"].")}y||m.dispatchEvent(f.CHATEASE_RENDER_ERROR,{message:"No suitable skin found!",skin:m.config.skin.name})}})(chatease);
(function(c){var e=c.utils,f=c.events;c.core.userattributes=function(b,a){function c(a){var b=-1;return 0>a?b=3E3:0==a?b=2E3:8<=a?b=0:0<(7&a)&&(b=1E3),b}var d,g=e.extend(this,new f.eventdispatcher("core.channel_"+a)),k=-1,w=0,x=0,u=!1,n={code:0,time:0};g.getId=function(){return a};g.getRole=function(){return k};g.getState=function(){return w};g.getInterval=function(){return d};g.setProperties=function(a,b){k=a;w=b;d=c(k);u=!0};g.setPunishment=function(a){n.code=a.code;n.time=a.time};g.getPunishment=
function(){return 0==n.code||n.time>=(new Date).getTime()?(n.code=0,n.time=0,null):e.extend({},n)};g.setActive=function(){var a=(new Date).getTime();return 0<x&&(0>d||d>a-x)?!1:(x=a,!0)};g.joined=function(){return u};d=c(k)}})(chatease);
(function(c){var e=c.utils,f=c.events,b=c.core;b.entity=function(a){var c,d,g,k=e.extend(this,new f.eventdispatcher("core.entity"));k.setup=function(){d.setup()};k.destroy=function(){g&&g.stop();d&&d.destroy();c&&c.destroy()};k.id=a.id;k.model=c=new b.model(a);k.view=d=new b.view(k,c);k.controller=g=new b.controller(c,d);g.addGlobalListener(function(a){k.dispatchEvent(a.type,a)});k.send=g.send;k.join=g.join;k.resize=d.resize}})(chatease);
(function(c){var e=c.utils,f=c.events,b=c.core,a=b.states;b.model=function(c){var d=e.extend(this,new f.eventdispatcher("core.model")),g={};d.setState=function(a){a!==d.state&&(d.state=a,d.dispatchEvent(f.CHATEASE_STATE,{state:a}))};d.setMsgShield=function(a){a!==d.shieldMsg&&(d.shieldMsg=a,d.dispatchEvent(f.CHATEASE_VIEW_SHIELDMSG,{shield:a}))};d.getConfig=function(a){return d.config[a]||{}};d.getAttributes=function(a){return 0==g.hasOwnProperty(a)&&(g[a]=new b.userattributes(d,a)),g[a]};d.destroy=
function(){};d.config=e.extend({},{},c);e.extend(d,{id:c.id,user:{id:0/0,name:""},state:a.CLOSED,shieldMsg:!1},d.config)}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core;var b=(c.states,c.renders),a=b.modes,h=(e.css,"chatwrap");c.view=function(c,g){function k(){switch(g.render.name){case a.DEFAULT:var c=e.extend(g.getConfig("render"),{id:g.id,width:g.width,height:g.height,channel:g.channel,maxlength:g.maxlength,maxRecords:g.maxRecords});l.render=p=new b[a.DEFAULT](l,c);break;default:l.dispatchEvent(f.CHATEASE_SETUP_ERROR,{message:"Unknown render mode!",render:g.render.name})}p&&(p.addEventListener(f.CHATEASE_VIEW_SEND,
w),p.addEventListener(f.CHATEASE_VIEW_SHIELDMSG,x),p.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,u),p.addEventListener(f.CHATEASE_VIEW_NICKCLICK,n),p.addEventListener(f.CHATEASE_RENDER_ERROR,q),v.appendChild(p.element()))}function w(a){t(a)}function x(a){t(a)}function u(a){t(a)}function n(a){t(a)}function q(a){t(a)}function t(a){l.dispatchEvent(a.type,a)}function r(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:p.send()}return/13/.test(a.keyCode)?(a.preventDefault?a.preventDefault():
a.returnValue=!1,!1):void 0}var v,p,l=e.extend(this,new f.eventdispatcher("core.view"));l.setup=function(){k();try{v.addEventListener("keydown",r)}catch(a){v.attachEvent("onkeydown",r)}setTimeout(function(){l.dispatchEvent(f.CHATEASE_READY,{channelId:c.id})},0)};l.show=function(a,b){g.shieldMsg||p&&p.show(a,b)};l.user=function(){return g.user};l.resize=function(a,b){p&&p.resize(a,b)};l.destroy=function(){v&&v.removeEventListener("keydown",r);p&&p.destroy()};(function(){v=e.createElement("div",h);
v.id=c.id;v.tabIndex=0;var a=document.getElementById(c.id);a.parentNode.replaceChild(v,a);window.onresize=function(){"function"==e.typeOf(g.onresize)?g.onresize.call(null):l.resize()}})()}})(chatease);
(function(c){var e=c.utils,f=c.events;c=c.core;var b=c.states;c.controller=function(a,c){function d(){if(!r){c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{r=window.WebSocket?new WebSocket(a.url):window.MozWebSocket?new MozWebSocket(a.url):new SockJS(a.url.replace(/^ws/,"http")+"/sockjs")}catch(d){return e.log("Failed to initialize websocket."),void 0}r.onopen=function(){a.setState(b.CONNECTED)};r.onmessage=g;r.onerror=function(){a.setState(b.ERROR)};r.onclose=function(){a.setState(b.CLOSED)}}}
function g(b){var d,g,n;try{d=eval("("+b.data+")")}catch(p){return e.log("Eval failed. \nerr: "+p+"\ndata: "+b.data),void 0}switch(d.raw){case "identity":e.foreach(d.user,function(b,c){a.user.hasOwnProperty(b)&&(a.user[b]=c)});c.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+d.channel.id+"\uff09\u3002");b=a.getAttributes(d.channel.id);b.setProperties(d.channel.role,d.channel.state);0==(2&d.channel.state)&&c.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");1==d.channel.hasOwnProperty("punishment")&&
(g=d.channel.punishment,b.setPunishment(g),0<(2&g.code)&&(n=new Date,n.setTime(g.time),c.show("\u60a8\u5df2\u88ab\u7981\u8a00\uff08"+e.formatTime(n)+"\uff09\uff01")));q.dispatchEvent(f.CHATEASE_INDENT,d);break;case "message":try{v||(v=new e.filter(a.keywords)),d.text=v.replace(d.text)}catch(p){e.log("Failed to execute filter.")}c.show(d,e.extend({},d.user,{channel:d.channel}));q.dispatchEvent(f.CHATEASE_MESSAGE,d);break;case "join":c.show(x(d.channel.role)+" "+d.user.name+" \u8fdb\u5165\u804a\u5929\u5ba4\u3002");
q.dispatchEvent(f.CHATEASE_JOIN,d);break;case "left":c.show(x(d.channel.role)+" "+d.user.name+" \u5df2\u79bb\u5f00\u3002");q.dispatchEvent(f.CHATEASE_LEFT,d);break;case "error":k(d.error.code,d);break;default:e.log("Unknown data type: "+d.raw+", ignored.")}}function k(a,b){var d,g=w(a);g&&c.show(g);d={raw:"error",error:{code:a,explain:g}};e.foreach(b,function(a,b){"cmd"!=a&&"raw"!=a&&"error"!=a&&(d[a]=b)});q.dispatchEvent(f.CHATEASE_ERROR,d)}function w(a){var b="";switch(a){case 400:b="\u9519\u8bef\u8bf7\u6c42\uff01";
break;case 401:b="\u8bf7\u5148\u767b\u5f55\uff01";break;case 403:b="\u6743\u9650\u9519\u8bef\uff01";break;case 404:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case 406:b="\u975e\u6cd5\u8bf7\u6c42\uff01";break;case 409:b="\u64cd\u4f5c\u9891\u7e41\uff01"}return b}function x(a){var b="";switch(e.typeOf(a)){case "string":if(a=parseInt(a),0/0==a||0>a)break;case "number":192&a?b="\u8d85\u7ba1":32&a?b="\u4e3b\u64ad":24&a?b="\u623f\u7ba1":7&a&&(b="VIP"+(7&a))}return b}function u(){if(!a.maxRetries||p<a.maxRetries){var b=
Math.ceil(a.retryDelay+5E3*Math.random());c.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+b/1E3+"\u79d2...");setTimeout(function(){p++;r=null;d()},b)}}function n(a){q.dispatchEvent(a.type,a)}var q=e.extend(this,new f.eventdispatcher("core.controller")),t=!1,r,v,p=0;q.send=function(c){var f,g,h;return r&&a.state!=b.CLOSED?"object"!=e.typeOf(c)||0==c.hasOwnProperty("cmd")||0==c.hasOwnProperty("channel")||0==c.channel.hasOwnProperty("id")?(k(400,c),void 0):(f=c.channel.id,g=a.getAttributes(f),0==
g.setActive()?(k(409,c),void 0):(h=g.getPunishment(),null!=h&&0<(2&h.code)?(k(403,c),void 0):(r.send(JSON.stringify(c)),void 0))):(d(),void 0)};q.close=function(){r&&r.close()};a.addEventListener(f.CHATEASE_STATE,function(d){switch(d.state){case b.CONNECTED:c.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");p=0;q.dispatchEvent(f.CHATEASE_CONNECT);break;case b.CLOSED:c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");q.dispatchEvent(f.CHATEASE_CLOSE,{channel:{id:a.channel}});u();break;
case b.ERROR:c.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");q.dispatchEvent(f.CHATEASE_ERROR,{message:"Chat room error!",channel:{id:a.channel}});break;default:q.dispatchEvent(f.CHATEASE_ERROR,{message:"Unknown model state!",state:d.state})}});a.addEventListener(f.CHATEASE_VIEW_SHIELDMSG,function(a){n(a)});c.addEventListener(f.CHATEASE_READY,function(c){t||(n(c),t=!0,d(),window.onbeforeunload=function(){r&&a.state==b.CONNECTED&&r.close()})});c.addEventListener(f.CHATEASE_VIEW_SEND,function(b){return b.data.text=
e.trim(a.maxlength?b.data.text.substr(0,a.maxlength):b.data.text),b.data.text?(q.send({cmd:"message",text:b.data.text,type:b.data.type,channel:{id:b.data.channel}}),void 0):(c.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01"),void 0)});c.addEventListener(f.CHATEASE_VIEW_SHIELDMSG,function(b){a.setMsgShield(b.shield)});c.addEventListener(f.CHATEASE_VIEW_CLEARSCREEN,function(a){c.render.clearScreen();n(a)});c.addEventListener(f.CHATEASE_VIEW_NICKCLICK,function(a){n(a)});c.addEventListener(f.CHATEASE_SETUP_ERROR,
function(a){n(a)});c.addEventListener(f.CHATEASE_RENDER_ERROR,function(a){n(a)})}})(chatease);
(function(c){var e,f=c.utils,b=c.events;c.core.renders.modes;e=c.embed=function(a){function h(a){switch(a.type){case b.ERROR:case b.CHATEASE_SETUP_ERROR:case b.CHATEASE_RENDER_ERROR:case b.CHATEASE_ERROR:d.errorScreen(a.message);d.dispatchEvent(b.ERROR,a);break;default:d.dispatchEvent(a.type,a)}}var d=f.extend(this,new b.eventdispatcher("embed")),g={},k=!1,w=null;d.embed=function(){try{g=new e.config(a.config),w=new e.embedder(a,g)}catch(c){return f.log("Failed to init embedder!"),d.dispatchEvent(b.CHATEASE_SETUP_ERROR,
{message:"Failed to init embedder!",render:g.render.name}),void 0}w.addGlobalListener(h);w.embed()};d.errorScreen=function(a){k||(k=!0,c.api.displayError(a,g))};(function(){f.foreach(a.config.events,function(b,c){var d=a[b];"function"===f.typeOf(d)&&d.call(a,c)})})()}})(chatease);
(function(c){var e=c.utils,f=(c.events,c.embed),b=c.core.renders.modes,a=c.core.renders.skins.modes;f.config=function(c){c=e.extend({},{url:"ws://"+window.location.host+"/chatease/ch1",width:300,height:450,channel:"ch1",token:"",keywords:"",maxlength:30,maxRetries:0,retryDelay:3E3,render:{name:b.DEFAULT,skin:{name:a.DEFAULT}},maxRecords:50},c);switch(e.typeOf(c.channel)){case "array":break;case "number":c.channel=[c.channel];break;case "string":c.channel=c.channel.split(",");break;default:c.channel=
[1]}return c};f.config.addConfig=function(a,b){return e.extend(a,b)}})(chatease);(function(c){var e=c.utils,f=c.events,b=c.embed,a=c.core;a.renders.modes;b.embedder=function(b,c){function g(a){k.dispatchEvent(a.type,a)}var k=e.extend(this,new f.eventdispatcher("embed.embedder"));k.embed=function(){var e=new a.entity(c);e.addGlobalListener(g);e.setup();b.setEntity(e,c.render.name)}}})(chatease);