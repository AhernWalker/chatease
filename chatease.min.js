chatease=function(){if(chatease.api)return chatease.api.getInstance.apply(this,arguments)};chatease.version="1.0.00";
(function(b){var e=b.utils={};e.exists=function(a){switch(e.typeOf(a)){case "string":return 0<a.length;case "object":return null!==a;case "null":return!1}return!0};e.extend=function(){var a=Array.prototype.slice.call(arguments,0),c=a[0];if(1<a.length)for(var d=1;d<a.length;d++)e.foreach(a[d],function(a,e){void 0!==e&&null!==e&&(c[a]=e)});return c};e.foreach=function(a,c){for(var d in a)a.hasOwnProperty&&"function"===e.typeOf(a.hasOwnProperty)?a.hasOwnProperty(d)&&c(d,a[d]):c(d,a[d])};e.getCookie=
function(a){var c;return(c=document.cookie.match(new RegExp("(^| )"+a+"=([^;]*)(;|$)")))?unescape(c[2]):null};e.formatTime=function(a){var c=a.getHours()+1,d=a.getMinutes(),b=a.getSeconds();return a.toLocaleDateString()+" "+e.pad(c,2)+":"+e.pad(d,2)+":"+e.pad(b,2)};e.pad=function(a,c){for(a+="";a.length<c;)a="0"+a;return a};e.createElement=function(a,c){a=document.createElement(a);c&&(a.className=c);return a};e.addClass=function(a,c){var d="string"===e.typeOf(a.className)?a.className.split(" "):[];
c="array"===e.typeOf(c)?c:c.split(" ");e.foreach(c,function(c,a){-1===e.indexOf(d,a)&&d.push(a)});a.className=e.trim(d.join(" "))};e.removeClass=function(a,c){var d="string"===e.typeOf(a.className)?a.className.split(" "):[];c="array"===e.typeOf(c)?c:c.split(" ");e.foreach(c,function(a,c){a=e.indexOf(d,c);0<=a&&d.splice(a,1)});a.className=e.trim(d.join(" "))};e.emptyElement=function(a){for(;a.firstChild;)a.removeChild(a.firstChild)};e.typeOf=function(a){if(null===a||void 0===a)return"null";var c=typeof a;
if("object"===c)try{if("[object Array]"===toString.call(a))return"array"}catch(d){}return c};e.trim=function(a){return a.replace(/^\s+|\s+$/g,"")};e.indexOf=function(a,c){if(null==a)return-1;for(var e=0;e<a.length;e++)if(a[e]===c)return e;return-1};e.isMSIE=function(a){return a?(a=parseFloat(a).toFixed(1),a=new RegExp("msie\\s*"+a,"i"),null!==navigator.userAgent.toLowerCase().match(a)):null!==navigator.userAgent.toLowerCase().match(/msie/i)};var g=window.console=window.console||{log:function(){}};
e.log=function(){var a=Array.prototype.slice.call(arguments,0);"object"===e.typeOf(g.log)?g.log(a):g.log.apply(g,a)}})(chatease);
(function(b){function e(){var a=document.createElement("style");a.type="text/css";document.getElementsByTagName("head")[0].appendChild(a);return a.sheet||a.styleSheet}var g=b.utils,a;(g.css=function(c,d){a||(a=e());var b="";g.foreach(d,function(a,e){b+=a+": "+e+"; "});try{a.insertRule?a.insertRule(c+" { "+b+"}",a.cssRules.length):a.addRule(c,b,a.rules.length)}catch(f){g.log("Failed to insert css rule: "+c)}}).style=function(a,e,b){if(void 0!==a&&null!==a)for(void 0===a.length&&(a=[a]),e=g.extend({},
e),b=0;b<a.length;b++){var c=a[b];void 0!==c&&null!==c&&g.foreach(e,function(a,e){a=a.split("-");for(var b=1;b<a.length;b++)a[b]=a[b].charAt(0).toUpperCase()+a[b].slice(1);a=a.join("");c.style[a]!==e&&(c.style[a]=e)})}}})(chatease);(function(b){var e=b.utils;e.filter=function(b){var a,c="";this.replace=function(e){return c&&a?e.replace(a,"**"):e};"string"==e.typeOf(b)&&b&&(c=b,a=new RegExp(c,"ig"))}})(chatease);
(function(b){b.events={ERROR:"error",CHATEASE_READY:"chateaseReady",CHATEASE_SETUP_ERROR:"chateaseSetupError",CHATEASE_RENDER_ERROR:"chateaseRenderError",CHATEASE_STATE:"chateaseState",CHATEASE_PROPERTY:"chateaseProperty",CHATEASE_CONNECT:"chateaseConnect",CHATEASE_INDENT:"chateaseIdent",CHATEASE_MESSAGE:"chateaseMessage",CHATEASE_JOIN:"chateaseJoin",CHATEASE_LEFT:"chateaseLeft",CHATEASE_CLOSE:"chateaseClose",CHATEASE_VIEW_SEND:"chateaseViewSend",CHATEASE_VIEW_PROPERTY:"chateaseViewProperty",CHATEASE_VIEW_CLEARSCREEN:"chateaseViewClearScreen",
CHATEASE_VIEW_NICKCLICK:"chateaseViewNickClick"}})(chatease);
(function(b){var e=b.utils;b.events.eventdispatcher=function(g){function a(a,c,b){if(a)for(var d=0;d<a.length;d++){var f=a[d];if(f){null!==f.count&&0===--f.count&&delete a[d];try{f.listener(c)}catch(v){e.log('Error handling "'+b+'" event listener ['+d+"]: "+v.toString(),f.listener,c)}}}}var c={},d=[];this.addEventListener=function(a,b,d){try{e.exists(c[a])||(c[a]=[]),"string"===e.typeOf(b)&&(b=(new Function("return "+b))()),c[a].push({listener:b,count:d||null})}catch(n){e.log("error",n)}return!1};
this.removeEventListener=function(a,b){if(c[a]){try{if(void 0===b){c[a]=[];return}var d;for(d=0;d<c[a].length;d++)if(c[a][d].listener.toString()===b.toString()){c[a].splice(d,1);break}}catch(n){e.log("error",n)}return!1}};this.addGlobalListener=function(a,b){try{"string"===e.typeOf(a)&&(a=(new Function("return "+a))()),d.push({listener:a,count:b||null})}catch(m){e.log("error",m)}return!1};this.removeGlobalListener=function(a){if(a){try{var b;for(b=d.length-1;0<=b;b--)d[b].listener.toString()===a.toString()&&
d.splice(b,1)}catch(m){e.log("error",m)}return!1}};this.dispatchEvent=function(h,f){f||(f={});e.extend(f,{id:g,version:b.version,type:h});b.debug&&e.log(h,f);a(c[h],f,h);a(d,f,h)}}})(chatease);
(function(b){var e=b.utils,g=b.events,a={},c={onError:g.ERROR,onReady:g.CHATEASE_READY,onConnect:g.CHATEASE_CONNECT,onIdent:g.CHATEASE_INDENT,onMessage:g.CHATEASE_MESSAGE,onJoin:g.CHATEASE_JOIN,onLeft:g.CHATEASE_LEFT,onNickClick:g.CHATEASE_VIEW_NICKCLICK,onClose:g.CHATEASE_CLOSE};b.api=function(a){function d(a){f.dispatchEvent(a.type,a)}var f=e.extend(this,new g.eventdispatcher("api")),m;f.container=a;f.id=a.id;f.setup=function(a){e.emptyElement(f.container);b.debug=!!a.debug;f.config=a;f.config.id=
f.id;f.embedder=new b.embed(f);f.embedder.addGlobalListener(d);f.embedder.embed();return f};f.setEntity=function(a,e){m=a;f.renderName=e;f.send=m.send;f.resize=m.resize};(function(){e.foreach(c,function(a,e){f[a]=function(a){f.addEventListener(e,a)}})})()};b.api.getInstance=function(c){var d;null==c?c=0:c.nodeType?d=c:"string"===e.typeOf(c)&&(d=document.getElementById(c));if(d){var f=a[d.id];f||(a[c]=f=new b.api(d));return f}return"number"===e.typeOf(c)?a[c]:null};b.api.displayError=function(a,e){}})(chatease);
(function(b){b.core={}})(chatease);(function(b){b.core.states={CONNECTED:"connected",CLOSED:"closed",ERROR:"error"}})(chatease);
(function(b){b.core.protocol={};b=b.core.protocol;b.cmds={TEXT:"text",MUTE:"mute",KICKOUT:"kickout",PING:"ping"};b.raws={IDENT:"ident",TEXT:"text",JOIN:"join",LEFT:"left",MUTE:"mute",KICKOUT:"kickout",ERROR:"error",PONG:"pong"};b.roles={VISITOR:0,NORMAL:1,VIP:14,ASSISTANT:16,SECRETARY:32,ANCHOR:48,ADMIN:64,SU_ADMIN:128,SYSTEM:192};b.channelStates={NORMAL:0,MUTED:1,LOCKED:3};b.punishments={MUTED:1,KICKED_OUT:3};b.errors={BAD_REQUEST:400,UNAUTHORIZED:401,FORBIDDED:403,NOT_FOUND:404,CONFLICT:409}})(chatease);
(function(b){b.core.skins={}})(chatease);(function(b){b.core.skins.modes={DEFAULT:"def"}})(chatease);
(function(b){var e=b.utils,g=b.events;b=b.core.skins;var a=b.modes,c=e.css,d="cha-skin";b.def=function(b){var f=e.extend(this,new g.eventdispatcher("skins.def")),h=b.width,n=b.height;f.resize=function(a,b){e.log("Resizing to "+a+", "+b);h=parseInt(a);n=parseInt(b)};f.name=a.DEFAULT;d+="-"+f.name;c(".cha-wrapper",{width:h+"px",height:n+"px","box-shadow":"0 1px 1px rgba(0, 0, 0, 0.05)"});c(".cha-wrapper *",{margin:"0",padding:"0","font-family":"\u5fae\u8f6f\u96c5\u9ed1,arial,sans-serif","font-size":"14px",
"font-weight":"normal","box-sizing":"content-box"});c("."+d+" .cha-render",{width:h-2+"px",height:n-2+"px",border:"1px solid #1184ce","border-radius":"4px",position:"relative"});c("."+d+" .cha-render .cha-title",{padding:"auto 12px",width:"100%",height:"40px","font-family":"inherit","font-weight":"normal",color:"#FFFFFF","text-align":"center","line-height":"40px","vertical-align":"middle","box-shadow":"none","background-color":"#1184CE",cursor:"not-allowed","pointer-events":"none"});c("."+d+" .cha-render .cha-console",
{width:"100%",height:.75*(n-2-parseInt("40px")-parseInt("40px"))+"px","max-height":.75*(n-2-parseInt("40px")-parseInt("40px"))+"px","overflow-y":"auto","background-color":"#F8F8F8"});c("."+d+" .cha-render .cha-console > div",{margin:"5px","word-break":"break-all","word-wrap":"break-word"});c("."+d+" .cha-render .cha-console > div.cha-system > a",{"font-style":"normal","font-weight":"bold",color:"red"});c("."+d+" .cha-render .cha-console > div.cha-myself",{});c("."+d+" .cha-render .cha-console > div.cha-myself > a",
{});c("."+d+" .cha-render .cha-console > div > span.ico-visitor",{"margin-right":"5px"});c("."+d+" .cha-render .cha-console > div > span.ico-normal",{"margin-right":"5px"});c("."+d+" .cha-render .cha-console > div > span.ico-vip1",{});c("."+d+" .cha-render .cha-console > div > span.ico-vip2",{});c("."+d+" .cha-render .cha-console > div > span.ico-vip3",{});c("."+d+" .cha-render .cha-console > div > span.ico-vip4",{});c("."+d+" .cha-render .cha-console > div > span.ico-vip5",{});c("."+d+" .cha-render .cha-console > div > span.ico-vip6",
{});c("."+d+" .cha-render .cha-console > div > span.ico-vip7",{});c("."+d+" .cha-render .cha-console > div > span.ico-assistant",{});c("."+d+" .cha-render .cha-console > div > span.ico-secretary",{});c("."+d+" .cha-render .cha-console > div > span.ico-anchor",{});c("."+d+" .cha-render .cha-console > div > span.ico-admin",{});c("."+d+" .cha-render .cha-console > div > span.ico-suadmin",{});c("."+d+" .cha-render .cha-console > div > span.ico-system",{});c("."+d+" .cha-render .cha-console > div > a",
{"margin-right":"5px",color:"#1184CE","text-decoration":"none",cursor:"pointer"});c("."+d+" .cha-render .cha-controls",{width:"100%",height:parseInt("40px")-2+"px",border:"1px solid #1184CE","border-width":"1px 0"});c("."+d+" .cha-render .cha-controls > *",{margin:"5px",height:parseInt("40px")-12+"px","line-height":parseInt("40px")-12+"px","text-align":"center","vertical-align":"middle","box-sizing":"border-box",display:"inline-block"});c("."+d+" .cha-render .cha-controls > .cha-checkbox",{color:"#666666",
"vertical-align":"middle",cursor:"pointer"});c("."+d+" .cha-render .cha-controls > .cha-checkbox > label",{height:parseInt("40px")-12+"px",display:"block"});c("."+d+" .cha-render .cha-controls > .cha-checkbox input[type=checkbox]",{"margin-right":"5px",cursor:"pointer"});c("."+d+" .cha-render .cha-controls > .cha-checkbox a",{});c("."+d+" .cha-render .cha-controls > .cha-button",{padding:"3px 5px",color:"#FFFFFF","text-align":"center","vertical-align":"middle","border-radius":"3px","background-color":"#1184CE",
cursor:"pointer"});c("."+d+" .cha-render .cha-controls .shieldtext",{"float":"left"});c("."+d+" .cha-render .cha-controls .clearscreen",{"float":"right"});c("."+d+" .cha-render .cha-dialog",{width:"100%",height:.25*(n-2-parseInt("40px")-parseInt("40px"))+"px",position:"relative",overflow:"hidden"});c("."+d+" .cha-render .cha-dialog .cha-input",{position:"relative"});c("."+d+" .cha-render .cha-dialog .cha-input textarea",{"float":"left",margin:"0",padding:"5px 10px",width:h-2-parseInt("50px")+"px",
height:.25*(n-2-parseInt("40px")-parseInt("40px"))-2+"px",resize:"none",border:"0 none","border-radius":"0 0 0 4px","box-sizing":"border-box",overflow:"auto"});c("."+d+" .cha-render .cha-dialog .cha-input button",{"float":"left",padding:0,width:"50px",height:.25*(n-2-parseInt("40px")-parseInt("40px"))+"px",color:"#FFFFFF",border:"0 none","box-sizing":"border-box","background-color":"#1184CE",cursor:"pointer"});e.isMSIE(7)&&(c("."+d+" .cha-render .cha-dialog .cha-input textarea",{width:h-2-parseInt("50px")-
20+"px",height:.25*(n-2-parseInt("40px")-parseInt("40px"))-12+"px"}),c("."+d+" .cha-render .cha-dialog .cha-input button",{height:.25*(n-2-parseInt("40px")-parseInt("40px"))+"px"}))}})(chatease);(function(b){b.core.renders={}})(chatease);(function(b){b.core.renders.modes={DEFAULT:"def"}})(chatease);
(function(b){var e=b.utils,g=b.events;b=b.core;var a=b.protocol.roles;b=b.renders;var c=b.modes;b.def=function(b,h){function d(a,b,c,d,f){b=e.createElement("div",b);var z=e.createElement("label");b.appendChild(z);var g=e.createElement("input");z.appendChild(g);g.type="checkbox";g.checked=!!f;c=function(a,b){return function(c){k.dispatchEvent(a,e.extend({checked:g.checked},b))}}(c,d);try{g.addEventListener("change",c)}catch(E){g.attachEvent("onchange",c)}c=e.createElement("a");z.appendChild(c);c.innerHTML=
a;return b}function m(a,b,c,d){b=e.createElement("div",b);var f=e.createElement("a");b.appendChild(f);f.innerHTML=a;a=function(a,b){return function(c){k.dispatchEvent(a,b)}}(c,d);try{f.addEventListener("click",a)}catch(z){f.attachEvent("onclick",a)}return b}function n(b){var c="";return"number"!=e.typeOf(b)&&(b=parseInt(b),NaN==b||0>b)?"":c=b&a.SYSTEM?(b&a.SYSTEM)==a.SYSTEM?c+"ico-system":b&a.SU_ADMIN?c+"ico-suadmin":c+"ico-admin":b&a.ANCHOR?(b&a.ANCHOR)==a.ANCHOR?c+"ico-anchor":b&a.SECRETARY?c+"ico-secretary":
c+"ico-assistant":b&a.VIP?c+("ico-vip"+((b&a.VIP)-1)):(b&a.NORMAL)==a.NORMAL?c+"ico-normal":c+"ico-visitor"}var k=e.extend(this,new g.eventdispatcher("renders.def")),v,w,p,q,y,x,u,l;k.setup=function(){};k.show=function(b,c,d){"object"!=e.typeOf(c)&&(c={id:0,name:"[\u7cfb\u7edf]",role:a.SYSTEM});"uni"!=d&&(d="multi");var f=e.createElement("div");c.role&a.SYSTEM&&(f.className="cha-system");"uni"==d&&(d=e.createElement("span"),d.innerHTML="[\u5bc6\u8bed]",f.appendChild(d));if(d=n(c.role))d=e.createElement("span",
d),f.appendChild(d);d=e.createElement("a");d.innerHTML=c.name;c=function(a){return function(b){k.dispatchEvent(g.CHATEASE_VIEW_NICKCLICK,{user:a})}}(c);try{d.addEventListener("click",c)}catch(A){d.attachEvent("onclick",c)}f.appendChild(d);f.insertAdjacentHTML("beforeend",b);p.childNodes.length>=k.config.maxrecords&&p.removeChild(p.childNodes[0]);p.appendChild(f);p.scrollTop=p.scrollHeight};k.send=function(){k.dispatchEvent(g.CHATEASE_VIEW_SEND,{data:{text:u.value,type:"multi"}});k.clearInput()};k.clearInput=
function(){u.value=""};k.clearScreen=function(){e.emptyElement(p)};k.element=function(){return v};k.resize=function(a,b){};k.destroy=function(){};k.name=c.DEFAULT;k.config=e.extend({},{},h);v=e.createElement("div","cha-render");(function(){w=e.createElement("div","cha-title");v.appendChild(w);w.innerHTML="\u804a\u5929\u5ba4";p=e.createElement("div","cha-console");v.appendChild(p);q=e.createElement("div","cha-controls");v.appendChild(q);var a=d("\u5c4f\u853d\u6d88\u606f","cha-checkbox shieldtext",
g.CHATEASE_VIEW_SHIELDMSG,null,!1);q.appendChild(a);a=m("\u6e05\u5c4f","cha-button clearscreen",g.CHATEASE_VIEW_CLEARSCREEN,null);q.appendChild(a);y=e.createElement("div","cha-dialog");v.appendChild(y);x=e.createElement("div","cha-input");y.appendChild(x);u=e.createElement("textarea");x.appendChild(u);l=e.createElement("button");x.appendChild(l);u.setAttribute("placeholder","\u8f93\u5165\u804a\u5929\u5185\u5bb9");k.config.maxlength&&u.setAttribute("maxlength",k.config.maxlength);a=function(){return function(a){a=
window.event||a;13==a.keyCode&&(a.ctrlKey?u.value+="\r\n":(k.send(),window.event?a.returnValue=!1:a.preventDefault()))}}();try{u.addEventListener("keypress",a)}catch(C){u.attachEvent("onkeypress",a)}l.innerHTML="\u53d1\u9001";a=function(){return function(){k.send()}}();try{l.addEventListener("click",a)}catch(C){l.attachEvent("onclick",a)}})()}})(chatease);
(function(b){var e=b.utils,g=b.events,a=b.core;a.entity=function(b){var c=e.extend(this,new g.eventdispatcher("core.entity")),h,f,m;c.setup=function(){setTimeout(function(){f.setup()},0)};c.destroy=function(){m&&m.stop();f&&f.destroy();h&&h.destroy()};c.id=b.id;c.model=h=new a.model(b);c.view=f=new a.view(c,h);c.controller=m=new a.controller(h,f);m.addGlobalListener(function(a){c.dispatchEvent(a.type,a)});c.send=m.send;c.getState=h.getState;c.resize=f.resize}})(chatease);
(function(b){var e=b.utils,g=b.events;b=b.core;var a=b.states,c=b.protocol,d=c.roles,h=c.channelStates,f=c.punishments,m=function(){var a=this;_interval=-1;_active=0;a.set=function(b){e.extend(a,b);1==b.hasOwnProperty("role")&&(b=b.role,_interval=0>b?-1:b>=d.ASSISTANT?0:b&d.VIP?500:b==d.NORMAL?1E3:2E3)};a.isMuted=function(){return!!(a.state&h.MUTED|a.punishment.code&f.MUTED)};a.isActive=function(){if(0>_interval)return!1;var a=(new Date).getTime();if(_active&&a-_active<_interval)return!1;_active=
a;return!0};e.extend(a,{channel:null,role:-1,state:0,punishment:{code:0,time:0}})};b.model=function(b){var c=e.extend(this,new g.eventdispatcher("core.model")),d=a.STOPPED,f;c.setState=function(a){a!==d&&(d=a,c.dispatchEvent(g.SLCIEASE_STATE,{state:a}))};c.setProperty=function(a,b){1==f.hasOwnProperty(a)&&(f[a]=b,c.dispatchEvent(g.CHATEASE_PROPERTY,{key:a,value:b}))};c.getProperty=function(a){return f[a]};c.getConfig=function(a){return c.config[a]||{}};c.destroy=function(){};c.config=e.extend({},
{},b);f={userinfo:new m,shield:!1}}})(chatease);
(function(b){var e=b.utils,g=b.events;b=b.core;var a=b.model.roles,c=b.renders,d=b.skins;b.view=function(b,f){function h(){var a=e.extend({},f.getConfig("render"),{id:b.id,width:f.config.width,height:f.config.height,maxlength:f.maxlength,maxrecords:f.maxRecords});try{l=p.render=new c[a.name](p,a),l.addEventListener(g.CHATEASE_VIEW_SEND,w),l.addEventListener(g.CHATEASE_VIEW_SHIELDMSG,w),l.addEventListener(g.CHATEASE_VIEW_CLEARSCREEN,w),l.addEventListener(g.CHATEASE_VIEW_NICKCLICK,w),l.addEventListener(g.CHATEASE_RENDER_ERROR,
v)}catch(t){e.log("Failed to init render "+a.name+"!")}l&&q.replaceChild(l.element(),y)}function n(){var a=e.extend({},f.getConfig("skin"),{id:b.id,width:f.config.width,height:f.config.height});try{r=new d[a.name](a)}catch(t){e.log("Failed to init skin "+a.name+"!")}}function k(a){if(a.ctrlKey||a.metaKey)return!0;switch(a.keyCode){case 13:l.send()}if(/13|32/.test(a.keyCode))return a.preventDefault?a.preventDefault():a.returnValue=!1,!1}function v(a){w(a)}function w(a){p.dispatchEvent(a.type,a)}var p=
e.extend(this,new g.eventdispatcher("core.view")),q,y,x,u,l,r;p.setup=function(){if(l){l.setup();try{q.addEventListener("keydown",k)}catch(C){q.attachEvent("onkeydown",k)}p.dispatchEvent(g.CHATEASE_READY)}else p.dispatchEvent(g.CHATEASE_SETUP_ERROR,{message:"Render not available!",name:f.config.render.name})};p.show=function(b,c,e){(!c||c.role&a.SYSTEM||!f.getProperty("shield"))&&l&&l.show(b,c,e)};p.resize=function(a,b){l&&l.resize(a,b);r&&r.resize(a,b)};p.destroy=function(){q&&q.removeEventListener("keydown",
k);l&&l.destroy()};(function(){q=e.createElement("div","cha-wrapper cha-skin-"+f.config.skin.name);q.id=b.id;q.tabIndex=0;y=e.createElement("div","cha-render");x=e.createElement("div","cha-poster");u=e.createElement("div","cha-contextmenu");q.appendChild(y);q.appendChild(x);q.appendChild(u);h();n();var a=document.getElementById(b.id);a.parentNode.replaceChild(q,a);window.onresize=function(){"function"==e.typeOf(f.config.onresize)&&f.config.onresize.call(null)}})()}})(chatease);
(function(b){var e=b.utils,g=b.events;b=b.core;var a=b.states,c=b.protocol,d=c.cmds,h=c.raws,f=c.roles,m=c.channelStates,n=c.punishments,k=c.errors;b.controller=function(b,c){function p(){if(t&&b.state!=a.CONNECTED)e.log("Websocket had connected already.");else{c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u4e2d\u2026");try{t=window.WebSocket?new WebSocket(b.config.url):window.MozWebSocket?new MozWebSocket(b.config.url):new SockJS(b.config.url.replace(/^ws/,"http")+"/sockjs")}catch(z){e.log("Failed to initialize websocket: "+
z);return}t.onopen=function(c){b.setState(a.CONNECTED)};t.onmessage=q;t.onerror=function(c){b.setState(a.ERROR)};t.onclose=function(c){b.setState(a.CLOSED)}}}function q(a){var d;try{d=eval("("+a.data+")")}catch(D){e.log("Failed to parse JSON. \nError: "+D+"\ndata: "+a.data);return}switch(d.raw){case h.IDENT:a=b.getProperty("userinfo");a.set(e.extend({},d.user,{channel:d.channel.id,role:d.channel.role,state:d.channel.state}));c.show("\u5df2\u52a0\u5165\u623f\u95f4\uff08"+a.channel+"\uff09\u3002");
a.state&m.MUTED&&c.show("\u60a8\u6240\u5728\u7684\u7528\u6237\u7ec4\u4e0d\u80fd\u53d1\u8a00\uff01");if(a.punishment.code&n.MUTED){var f=new Date;f.setTime(a.punishment.time);c.show("\u60a8\u5df2\u88ab\u7981\u8a00\u81f3\uff08"+e.formatTime(f)+"\uff09\uff01")}r.dispatchEvent(g.CHATEASE_INDENT,d);break;case h.TEXT:try{B||(B=new e.filter(b.keywords)),d.text=B.replace(d.text)}catch(D){e.log("Failed to execute filter.")}c.show(d.text,d.user,d.type);r.dispatchEvent(g.CHATEASE_MESSAGE,d);break;case h.JOIN:a=
v(d.user.role);c.show((a?a+" ":"")+d.user.name+" \u8fdb\u5165\u623f\u95f4\u3002");r.dispatchEvent(g.CHATEASE_JOIN,d);break;case h.LEFT:a=v(d.user.role);c.show((a?a+" ":"")+d.user.name+" \u5df2\u79bb\u5f00\u3002");r.dispatchEvent(g.CHATEASE_LEFT,d);break;case h.ERROR:x(d.error.code,d);break;default:e.log("Unknown data type: "+d.raw+", ignored.")}}function v(a){var b="";if("number"!=e.typeOf(a)&&(a=parseInt(a),NaN==a||0>a))return"";a&f.SYSTEM?b=(a&f.SYSTEM)==f.SYSTEM?b+"[\u7cfb\u7edf]":a&f.SU_ADMIN?
b+"[\u8d85\u7ba1]":b+"[\u7ba1\u7406\u5458]":a&f.ANCHOR?b=(a&f.ANCHOR)==f.ANCHOR?b+"[\u4e3b\u64ad]":a&f.SECRETARY?b+"[\u52a9\u7406]":b+"[\u623f\u7ba1]":a&f.VIP?b+="[VIP"+((a&f.VIP)-1)+"]":(a&f.NORMAL)!=f.NORMAL&&(b+="[\u6e38\u5ba2]");return b}function x(a,b){var d=u(a);d&&c.show(d);var f={raw:"error",error:{code:a,explain:d}};e.foreach(b,function(a,b){"cmd"!=a&&"raw"!=a&&"error"!=a&&(f[a]=b)});r.dispatchEvent(g.ERROR,f)}function u(a){var b="";switch(a){case k.BAD_REQUEST:b="\u9519\u8bef\u8bf7\u6c42\uff01";
break;case k.UNAUTHORIZED:b="\u8bf7\u5148\u767b\u5f55\uff01";break;case k.FORBIDDED:b="\u6743\u9650\u9519\u8bef\uff01";break;case k.NOT_FOUND:b="\u672a\u77e5\u8bf7\u6c42\uff01";break;case k.CONFLICT:b="\u64cd\u4f5c\u9891\u7e41\uff01"}return b}function l(a){r.dispatchEvent(a.type,a)}var r=e.extend(this,new g.eventdispatcher("core.controller")),w=!1,t,B,A=0;r.send=function(c){if(t&&b.state!=a.CLOSED)if("object"!=e.typeOf(c)||0==c.hasOwnProperty("cmd"))x(k.BAD_REQUEST,c);else{var d=b.getProperty("userinfo");
0==d.isActive()?x(k.CONFLICT,c):1==d.isMuted()?x(k.FORBIDDED,c):t.send(JSON.stringify(c))}else p()};r.close=function(){t&&t.close()};b.addEventListener(g.CHATEASE_STATE,function(d){switch(d.state){case a.CONNECTED:c.show("\u804a\u5929\u5ba4\u5df2\u8fde\u63a5\u2026");A=0;r.dispatchEvent(g.CHATEASE_CONNECT);break;case a.CLOSED:c.show("\u804a\u5929\u5ba4\u8fde\u63a5\u5df2\u65ad\u5f00\uff01");r.dispatchEvent(g.CHATEASE_CLOSE,{channel:{id:b.channel}});if(0>b.config.maxretries||A<b.config.maxretries)d=
Math.ceil(b.config.retrydelay+5E3*Math.random()),c.show("\u6b63\u5728\u51c6\u5907\u91cd\u8fde\uff0c"+d/1E3+"\u79d2..."),A++,t=null,setTimeout(p,d);break;case a.ERROR:c.show("\u804a\u5929\u5ba4\u5f02\u5e38\uff01");r.dispatchEvent(g.ERROR,{message:"Chat room error!",channel:{id:b.channel}});break;default:r.dispatchEvent(g.ERROR,{message:"Unknown model state!",state:d.state})}});b.addEventListener(g.CHATEASE_PROPERTY,function(a){l(a)});c.addEventListener(g.CHATEASE_READY,function(c){w||(w=!0,l(c),p(),
window.onbeforeunload=function(c){t&&b.state==a.CONNECTED&&t.close()})});c.addEventListener(g.CHATEASE_SETUP_ERROR,function(c){b.setState(a.ERROR);l(c)});c.addEventListener(g.CHATEASE_VIEW_SEND,function(a){var f=a.data.text;if(f){0<=b.config.maxlength&&(f=f.substr(0,b.config.maxlength));var f=e.trim(f),g=b.getProperty("userinfo");r.send({cmd:d.TEXT,text:f,type:a.data.type,channel:g.channel})}else c.show("\u8bf7\u8f93\u5165\u5185\u5bb9\uff01")});c.addEventListener(g.CHATEASE_VIEW_PROPERTY,function(a){b.setProperty(a.key,
a.value)});c.addEventListener(g.CHATEASE_VIEW_CLEARSCREEN,function(a){c.render.clearScreen();l(a)});c.addEventListener(g.CHATEASE_VIEW_NICKCLICK,function(a){l(a)});c.addEventListener(g.CHATEASE_RENDER_ERROR,function(c){b.setState(a.ERROR);l(c)})}})(chatease);
(function(b){var e=b.utils,g=b.events,a=b.embed=function(c){function d(a){switch(a.type){case g.ERROR:case g.CHATEASE_SETUP_ERROR:case g.CHATEASE_RENDER_ERROR:h.errorScreen(a.message);h.dispatchEvent(g.ERROR,a);break;default:h.dispatchEvent(a.type,a)}}var h=e.extend(this,new g.eventdispatcher("embed")),f={},m=null,n=!1;h.embed=function(){try{f=new a.config(c.config),m=new a.embedder(c,f)}catch(k){e.log("Failed to init embedder!");h.dispatchEvent(g.CHATEASE_SETUP_ERROR,{message:"Failed to init embedder!",
render:f.render.name});return}m.addGlobalListener(d);m.embed()};h.errorScreen=function(a){n||(n=!0,b.api.displayError(a,f))};(function(){e.foreach(c.config.events,function(a,b){a=c[a];"function"===e.typeOf(a)&&a.call(c,b)})})()}})(chatease);
(function(b){var e=b.utils,g=b.embed,a=b.core.renders.modes,c=b.core.skins.modes;g.config=function(b){return e.extend({},{url:"ws://"+window.location.host+"/chatease/ch1",width:300,height:450,keywords:"",maxlength:30,maxrecords:50,maxretries:-1,retrydelay:3E3,render:{name:a.DEFAULT},skin:{name:c.DEFAULT}},b)};g.config.addConfig=function(a,b){return e.extend(a,b)}})(chatease);
(function(b){var e=b.utils,g=b.events,a=b.core;b.embed.embedder=function(b,d){function c(a){f.dispatchEvent(a.type,a)}var f=e.extend(this,new g.eventdispatcher("embed.embedder"));f.embed=function(){var e=new a.entity(d);e.addGlobalListener(c);e.setup();b.setEntity(e,d.render.name)}}})(chatease);